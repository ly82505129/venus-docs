<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | 启明星</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/venus-logo.png">
    <meta name="description" content="GO语言实现的Filecoin分布式存储网络">
    
    <link rel="preload" href="/assets/css/0.styles.0460caa0.css" as="style"><link rel="preload" href="/assets/js/app.44eba00d.js" as="script"><link rel="preload" href="/assets/js/2.2da8aaea.js" as="script"><link rel="preload" href="/assets/js/18.78dd5e68.js" as="script"><link rel="prefetch" href="/assets/js/10.b1ca328d.js"><link rel="prefetch" href="/assets/js/100.4f326782.js"><link rel="prefetch" href="/assets/js/101.1a6d4ec0.js"><link rel="prefetch" href="/assets/js/102.1023f6bd.js"><link rel="prefetch" href="/assets/js/103.5d94b580.js"><link rel="prefetch" href="/assets/js/104.1c5967e0.js"><link rel="prefetch" href="/assets/js/105.538cfce0.js"><link rel="prefetch" href="/assets/js/106.ebc1cb16.js"><link rel="prefetch" href="/assets/js/107.6de8d600.js"><link rel="prefetch" href="/assets/js/108.3e75821d.js"><link rel="prefetch" href="/assets/js/109.88c12bb8.js"><link rel="prefetch" href="/assets/js/11.2ed2f72a.js"><link rel="prefetch" href="/assets/js/110.920d00dc.js"><link rel="prefetch" href="/assets/js/111.6783a0ac.js"><link rel="prefetch" href="/assets/js/112.b06bc65d.js"><link rel="prefetch" href="/assets/js/113.67be65fb.js"><link rel="prefetch" href="/assets/js/114.2bd8920a.js"><link rel="prefetch" href="/assets/js/115.7e6c6816.js"><link rel="prefetch" href="/assets/js/116.ea6e6f4d.js"><link rel="prefetch" href="/assets/js/117.76a08328.js"><link rel="prefetch" href="/assets/js/118.318acb6a.js"><link rel="prefetch" href="/assets/js/119.3a21e16c.js"><link rel="prefetch" href="/assets/js/12.beaa937a.js"><link rel="prefetch" href="/assets/js/120.c9873590.js"><link rel="prefetch" href="/assets/js/121.7c474562.js"><link rel="prefetch" href="/assets/js/122.8a81a2fa.js"><link rel="prefetch" href="/assets/js/123.7c2cba95.js"><link rel="prefetch" href="/assets/js/124.94d76ffd.js"><link rel="prefetch" href="/assets/js/125.d4b47933.js"><link rel="prefetch" href="/assets/js/126.e798efa8.js"><link rel="prefetch" href="/assets/js/127.207c125a.js"><link rel="prefetch" href="/assets/js/128.08ecf001.js"><link rel="prefetch" href="/assets/js/129.29c0e292.js"><link rel="prefetch" href="/assets/js/13.b76cefd0.js"><link rel="prefetch" href="/assets/js/130.d65dd5ae.js"><link rel="prefetch" href="/assets/js/131.48a36f0f.js"><link rel="prefetch" href="/assets/js/132.a20badb5.js"><link rel="prefetch" href="/assets/js/133.5aed0da7.js"><link rel="prefetch" href="/assets/js/134.fb701943.js"><link rel="prefetch" href="/assets/js/135.8d5fc77e.js"><link rel="prefetch" href="/assets/js/136.1d749adc.js"><link rel="prefetch" href="/assets/js/137.0fce8f65.js"><link rel="prefetch" href="/assets/js/138.26311557.js"><link rel="prefetch" href="/assets/js/139.6e6f90aa.js"><link rel="prefetch" href="/assets/js/14.c346d446.js"><link rel="prefetch" href="/assets/js/140.24bd6b0d.js"><link rel="prefetch" href="/assets/js/141.e7c9d65e.js"><link rel="prefetch" href="/assets/js/142.5f604db3.js"><link rel="prefetch" href="/assets/js/143.f9c7ea6c.js"><link rel="prefetch" href="/assets/js/144.7f7a44b7.js"><link rel="prefetch" href="/assets/js/145.f069bca1.js"><link rel="prefetch" href="/assets/js/15.b0d44dd3.js"><link rel="prefetch" href="/assets/js/16.e9060cc7.js"><link rel="prefetch" href="/assets/js/17.9c765ea6.js"><link rel="prefetch" href="/assets/js/19.c328aff0.js"><link rel="prefetch" href="/assets/js/20.c51e0b26.js"><link rel="prefetch" href="/assets/js/21.7fcbe3a6.js"><link rel="prefetch" href="/assets/js/22.63d8db03.js"><link rel="prefetch" href="/assets/js/23.d2062894.js"><link rel="prefetch" href="/assets/js/24.e70dee98.js"><link rel="prefetch" href="/assets/js/25.0ab3dc84.js"><link rel="prefetch" href="/assets/js/26.811d43ab.js"><link rel="prefetch" href="/assets/js/27.c141899b.js"><link rel="prefetch" href="/assets/js/28.a106a933.js"><link rel="prefetch" href="/assets/js/29.a0cc839b.js"><link rel="prefetch" href="/assets/js/3.9f078753.js"><link rel="prefetch" href="/assets/js/30.a6a2d732.js"><link rel="prefetch" href="/assets/js/31.7749eb7f.js"><link rel="prefetch" href="/assets/js/32.f4599c2a.js"><link rel="prefetch" href="/assets/js/33.364ea020.js"><link rel="prefetch" href="/assets/js/34.775ad373.js"><link rel="prefetch" href="/assets/js/35.bdf23530.js"><link rel="prefetch" href="/assets/js/36.16cad7f9.js"><link rel="prefetch" href="/assets/js/37.89518460.js"><link rel="prefetch" href="/assets/js/38.cb95af57.js"><link rel="prefetch" href="/assets/js/39.6762bb89.js"><link rel="prefetch" href="/assets/js/4.ec3bc137.js"><link rel="prefetch" href="/assets/js/40.9d98f05f.js"><link rel="prefetch" href="/assets/js/41.b7ab2e4e.js"><link rel="prefetch" href="/assets/js/42.d9fabb2b.js"><link rel="prefetch" href="/assets/js/43.d16e4196.js"><link rel="prefetch" href="/assets/js/44.c1b46b70.js"><link rel="prefetch" href="/assets/js/45.0e66d329.js"><link rel="prefetch" href="/assets/js/46.b7de120f.js"><link rel="prefetch" href="/assets/js/47.de945ea9.js"><link rel="prefetch" href="/assets/js/48.216216c4.js"><link rel="prefetch" href="/assets/js/49.e7ae15d8.js"><link rel="prefetch" href="/assets/js/5.202cd61b.js"><link rel="prefetch" href="/assets/js/50.735b1b91.js"><link rel="prefetch" href="/assets/js/51.d4baa2b3.js"><link rel="prefetch" href="/assets/js/52.779a3235.js"><link rel="prefetch" href="/assets/js/53.18d8db65.js"><link rel="prefetch" href="/assets/js/54.6868c074.js"><link rel="prefetch" href="/assets/js/55.c2557ba6.js"><link rel="prefetch" href="/assets/js/56.9c04f10b.js"><link rel="prefetch" href="/assets/js/57.0bb1ee60.js"><link rel="prefetch" href="/assets/js/58.82b7e3fa.js"><link rel="prefetch" href="/assets/js/59.38649fb5.js"><link rel="prefetch" href="/assets/js/6.db64c586.js"><link rel="prefetch" href="/assets/js/60.99f6a740.js"><link rel="prefetch" href="/assets/js/61.8f254d0e.js"><link rel="prefetch" href="/assets/js/62.ebd195e1.js"><link rel="prefetch" href="/assets/js/63.f605c55a.js"><link rel="prefetch" href="/assets/js/64.a46db42d.js"><link rel="prefetch" href="/assets/js/65.0a93ee78.js"><link rel="prefetch" href="/assets/js/66.fb9577ca.js"><link rel="prefetch" href="/assets/js/67.cc09c0a0.js"><link rel="prefetch" href="/assets/js/68.8054e65a.js"><link rel="prefetch" href="/assets/js/69.4f45f045.js"><link rel="prefetch" href="/assets/js/7.b1b25b0b.js"><link rel="prefetch" href="/assets/js/70.b959141f.js"><link rel="prefetch" href="/assets/js/71.c63596aa.js"><link rel="prefetch" href="/assets/js/72.512a1aeb.js"><link rel="prefetch" href="/assets/js/73.b1f7b736.js"><link rel="prefetch" href="/assets/js/74.724da6aa.js"><link rel="prefetch" href="/assets/js/75.c5e163a4.js"><link rel="prefetch" href="/assets/js/76.dee6b6f9.js"><link rel="prefetch" href="/assets/js/77.d37347d6.js"><link rel="prefetch" href="/assets/js/78.1d572875.js"><link rel="prefetch" href="/assets/js/79.43586756.js"><link rel="prefetch" href="/assets/js/8.db9a17e8.js"><link rel="prefetch" href="/assets/js/80.1276b5b3.js"><link rel="prefetch" href="/assets/js/81.01e5e27b.js"><link rel="prefetch" href="/assets/js/82.06b1743e.js"><link rel="prefetch" href="/assets/js/83.65a9aeb5.js"><link rel="prefetch" href="/assets/js/84.926e48ef.js"><link rel="prefetch" href="/assets/js/85.73b547c3.js"><link rel="prefetch" href="/assets/js/86.79a9029d.js"><link rel="prefetch" href="/assets/js/87.3b0838bf.js"><link rel="prefetch" href="/assets/js/88.afacd1b1.js"><link rel="prefetch" href="/assets/js/89.93373577.js"><link rel="prefetch" href="/assets/js/9.117b8ddf.js"><link rel="prefetch" href="/assets/js/90.afcc7a87.js"><link rel="prefetch" href="/assets/js/91.eab820da.js"><link rel="prefetch" href="/assets/js/92.c5006349.js"><link rel="prefetch" href="/assets/js/93.1a218bd9.js"><link rel="prefetch" href="/assets/js/94.7f558662.js"><link rel="prefetch" href="/assets/js/95.d3e4b649.js"><link rel="prefetch" href="/assets/js/96.15226166.js"><link rel="prefetch" href="/assets/js/97.781808f3.js"><link rel="prefetch" href="/assets/js/98.434323c3.js"><link rel="prefetch" href="/assets/js/99.1af3bbba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0460caa0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/Using-venus-Shared-Modules.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/guide/Using-venus-Shared-Modules.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/Using-venus-Shared-Modules.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/guide/Using-venus-Shared-Modules.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>快速上手</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/" aria-current="page" class="sidebar-link">启明星概要</a></li><li><a href="/zh/guide/How-To-Deploy-MingPool.html" class="sidebar-link">部署存储池</a></li><li><a href="/zh/guide/Using-venus-Shared-Modules.html" aria-current="page" class="active sidebar-link">加入存储池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#如何提供存储服务" class="sidebar-link">如何提供存储服务</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#venus模块介绍" class="sidebar-link">venus模块介绍</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#服务架构" class="sidebar-link">服务架构</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#硬件要求" class="sidebar-link">硬件要求</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#前期准备" class="sidebar-link">前期准备</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#安装venus-wallet" class="sidebar-link">安装venus-wallet</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#安装venus-sealer" class="sidebar-link">安装venus-sealer</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#开始封装" class="sidebar-link">开始封装</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#worker机制" class="sidebar-link">worker机制</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#加速项配置" class="sidebar-link">加速项配置</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#lotus-miner" class="sidebar-link">lotus-miner</a></li><li class="sidebar-sub-header"><a href="/zh/guide/Using-venus-Shared-Modules.html#问题" class="sidebar-link">问题?</a></li></ul></li><li><a href="/zh/guide/Using-venus-market.html" class="sidebar-link">发送接收订单</a></li><li><a href="/zh/guide/fil_withdraw_and_send.html" class="sidebar-link">提取奖励</a></li><li><a href="/zh/guide/chain.html" class="sidebar-link">链维护</a></li><li><a href="/zh/guide/How-To-Connect-Network.html" class="sidebar-link">加入不同网络</a></li><li><a href="/zh/guide/How-To-Contribute-Docs.html" class="sidebar-link">贡献文档</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>考虑到庞大的初始硬件和Filecoin质押<a href="https://filscan.io/calculator" target="_blank" rel="noopener noreferrer">投资<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以及相关的运营成本，开始Filecoin挖掘是一项艰巨的任务。 囊括了安全性、易用性和分布式存储池的想法，Venus将帮助存储提供者，正如社区所说，把<a href="https://filecoinproject.slack.com/archives/CEGN061C5/p1610810730117900?thread_ts=1610809298.116800&amp;cid=CEGN061C5" target="_blank" rel="noopener noreferrer">全职工作<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>变成为一个严肃的爱好。 希望本教程能让您立即开始挖矿！</p> <h2 id="如何提供存储服务"><a href="#如何提供存储服务" class="header-anchor">#</a> 如何提供存储服务</h2> <p>有两种方法可以开始使用Venus来提供存储服务。</p> <ol><li>部署最少的硬件并获得对第三方托管的共享venus模块的使用帐号。(本教程的其余部分将引导您完成这种部署Venus服务的方式)</li> <li>自行部署所有需要的硬件和venus模块。(请参阅<a href="/zh/guide/How-To-Deploy-MingPool.html">这个</a>教程以了解更多信息)</li></ol> <p>在遵循其余的教程和成功部署后，您可以开始封装扇区，增加算力并通过您对网络存储容量的贡献最终获得区块奖励！</p> <h2 id="venus模块介绍"><a href="#venus模块介绍" class="header-anchor">#</a> venus模块介绍</h2> <p>根据其在挖矿集群中的作用，模块可以大致分为两类：共享和独立。 共享模块可以被认为是开始封装扇区所需的基础。 大多数与区块链的交互，如链同步、发送消息、赢得赢票等，都是由共享模块处理的。 这个想法是许多矿工都可以共用一组共享模块，从而减少维护成本。 独立模块处理封装和证明您的扇区。如果您选择使用第三方托管的共享Venus模块，您将花费大部分时间在独立模块上。 另请注意，<code>venus-wallet</code>模块可以作为共享或独立部署。</p> <table><thead><tr><th>name</th> <th>role</th> <th>shared/independent</th></tr></thead> <tbody><tr><td><a href="https://github.com/filecoin-project/venus" target="_blank" rel="noopener noreferrer">venus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>daemon for chain interactions</td> <td>shared</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-miner" target="_blank" rel="noopener noreferrer">venus-miner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>block winning and proving</td> <td>shared</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-messager" target="_blank" rel="noopener noreferrer">venus-messager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>chain message management</td> <td>shared</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-auth" target="_blank" rel="noopener noreferrer">venus-auth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>utility for authorized use of shared modules</td> <td>shared</td></tr> <tr><td><a href="https://github.com/ipfs-force-community/venus-gateway" target="_blank" rel="noopener noreferrer">venus-gateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>utility for controlled access point of shared modules</td> <td>shared</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-wallet" target="_blank" rel="noopener noreferrer">venus-wallet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>addresses/keys management</td> <td>shared/independent</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-sealer" target="_blank" rel="noopener noreferrer">venus-sealer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/filecoin-project/venus-sealer" target="_blank" rel="noopener noreferrer">venus-worker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>job scheduling, sealing and proving</td> <td>independent</td></tr> <tr><td><a href="https://github.com/filecoin-project/venus-market" target="_blank" rel="noopener noreferrer">venus-market<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>deal making</td> <td>independent</td></tr></tbody></table> <h2 id="服务架构"><a href="#服务架构" class="header-anchor">#</a> 服务架构</h2> <p>下图展示了venus模块如何相互交互。</p> <p><img src="/assets/img/venus-cluster.39d38e43.png" alt="venus-cluster"></p> <h2 id="硬件要求"><a href="#硬件要求" class="header-anchor">#</a> 硬件要求</h2> <p>在<a href="https://github.com/filecoin-project/community-china/discussions/18" target="_blank" rel="noopener noreferrer">此处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>了解有关硬件要求的更多信息。或者参阅我们的<a href="https://venus.filecoin.io/zh/operation/example-single-box.html" target="_blank" rel="noopener noreferrer">单机配置示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="前期准备"><a href="#前期准备" class="header-anchor">#</a> 前期准备</h2> <p>在深入部署您的挖矿操作之前，请确保您已完成以下步骤。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>建议您在部署到主网上之前在<code>calibration</code>网络中测试您的配置。</p></div> <h3 id="永久存储"><a href="#永久存储" class="header-anchor">#</a> 永久存储</h3> <p>选择您熟悉的网络文件系统（例如 NFS）并部署您的存储集群。</p> <h3 id="在共享模块中设置您的帐户"><a href="#在共享模块中设置您的帐户" class="header-anchor">#</a> 在共享模块中设置您的帐户</h3> <p>有两种方法可以配置您的帐户。</p> <h4 id="对于需接入共享模块的用户"><a href="#对于需接入共享模块的用户" class="header-anchor">#</a> 对于需接入共享模块的用户</h4> <p>如果您尝试连接到第三方托管的共享venus模块，联系上述服务的管理员并让他们为您设置。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>venus-wallet 可以部署为共享或独立模块，具体取决于您的安全要求。</p></div> <h4 id="对于共享模块的管理员"><a href="#对于共享模块的管理员" class="header-anchor">#</a> 对于共享模块的管理员</h4> <p>如果您是托管共享 venus 模块的管理员，请使用以下命令注册各个集群。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 如果已有节点号</span>
$ ./venus-auth user <span class="token function">add</span> --name <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span> --miner <span class="token operator">&lt;</span>MINER_ID<span class="token operator">&gt;</span>

<span class="token comment"># 没有节点号，在创建节点号后更新</span>
$ ./venus-auth user <span class="token function">add</span> --name <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span>
$ ./venus-auth user update --name <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span> --miner <span class="token operator">&lt;</span>MINER_ID<span class="token operator">&gt;</span>

<span class="token comment"># 为此账号分配token，用于接入服务层验证</span>
$ ./venus-auth token gen --perm <span class="token function">write</span> <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>AUTH_TOKEN_FOR_ACCOUNT_NAME<span class="token operator">&gt;</span>
</code></pre></div><h3 id="软件依赖"><a href="#软件依赖" class="header-anchor">#</a> 软件依赖</h3> <p>在运行 venus 之前，您需要安装以下软件。</p> <h4 id="构建工具"><a href="#构建工具" class="header-anchor">#</a> 构建工具</h4> <p>Ubuntu/Debian:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mesa-opencl-icd ocl-icd-opencl-dev gcc <span class="token function">git</span> bzr jq pkg-config <span class="token function">curl</span> clang build-essential hwloc libhwloc-dev <span class="token function">wget</span> -y <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade -y
</code></pre></div><p>CentOS:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="token punctuation">;</span> <span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span> gcc bzr jq pkgconfig clang llvm mesa-libGL-devel opencl-headers ocl-icd ocl-icd-devel hwloc-devel
</code></pre></div><h3 id="rust"><a href="#rust" class="header-anchor">#</a> Rust</h3> <p>安装<a href="https://rustup.rs/" target="_blank" rel="noopener noreferrer">rustup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --proto <span class="token string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span>
</code></pre></div><h4 id="go"><a href="#go" class="header-anchor">#</a> Go</h4> <p>构建venus，您需要安装<a href="https://golang.org/dl/" target="_blank" rel="noopener noreferrer">Go 1.16 或更高版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> -c https://golang.org/dl/go1.16.2.linux-amd64.tar.gz -O - <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tar</span> -xz -C /usr/local
</code></pre></div><p>将 <code>/usr/local/go/bin</code> 添加到您的路径并设置<code>go env</code>。对于大多数Linux系统，您可以运行以下内容：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;export PATH=<span class="token environment constant">$PATH</span>:/usr/local/go/bin&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> ~/.bashrc
<span class="token comment"># setup go env</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn
go <span class="token function">env</span> -w <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
</code></pre></div><p>如果卡住，请参阅<a href="https://golang.org/doc/install" target="_blank" rel="noopener noreferrer">官方Golang安装说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="安装venus-wallet"><a href="#安装venus-wallet" class="header-anchor">#</a> 安装venus-wallet</h2> <p>下载并编译<code>Venus-wallet</code>的源代码。</p> <ul><li>首次编译</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-wallet.git
<span class="token comment"># change directory to venus-wallet</span>
$ <span class="token builtin class-name">cd</span> venus-wallet
$ <span class="token function">git</span> checkout -b incubation origin/incubation
$ <span class="token function">make</span>
</code></pre></div><ul><li>曾经成功编译过</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># change directory to venus-wallet,switch to the incubation branch</span>
$ <span class="token function">git</span> fetch
$ <span class="token function">git</span> pull
</code></pre></div><p>在后台运行<code>venus-wallet</code>模块。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用 <code>tail -f wallet.log</code> 来监控钱包日志。</p></div> <p>为您的<code>venus-wallet</code>设置密码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet setpwd
Password:******
Enter Password again:******
Password <span class="token builtin class-name">set</span> successfully
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请备份您的密码并妥善保存，否则你将无法使用wallet相关的功能。每次venus-wallet run启动时带--password标志会自动解锁钱包,如果没带,在wallet实例启动后你需要手动解锁:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet unlock
Password: 

<span class="token comment"># 查看解锁状态</span>
$ ./venus-wallet lock-state
wallet state: unlocked
</code></pre></div><p>在扇区封装的过程中需要调用wallet进行签名,如果不解锁,会导致签名失败,进而导致扇区任务失败.</p></div> <p>生成owner和worker地址。（如果您没有现有的miner ID）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet new bls
<span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>WORKER_ADDRESS<span class="token operator">&gt;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果您在<code>Calibration</code>上进行测试，则必须使用来自水龙头的测试币为您的所有地址提供资金。对于校准网，请使用此<a href="https://faucet.calibration.fildev.network/funds.html" target="_blank" rel="noopener noreferrer">水龙头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <p><em><strong>配置venus-wallet接入共享服务,使用您从共享模块管理员处获得的帐号信息更改 <code>~/.venus_wallet/config.toml</code>中的<code>[APIRegisterHub]</code> 部分</strong></em></p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">APIRegisterHub</span><span class="token punctuation">]</span>
<span class="token key property">RegisterAPI</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/ip4/&lt;IP_ADDRESS_OF_VENUS_GATEWAY&gt;/tcp/45132&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;AUTH_TOKEN_FOR_ACCOUNT_NAME&gt;&quot;</span>
<span class="token key property">SupportAccounts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;ACCOUNT_NAME&gt;&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>重新启动<code>venus-wallet</code>以使更改生效。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># grep [PID] of venus-wallet process</span>
$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> wallet
<span class="token comment"># kill the process and restart</span>
$ <span class="token function">kill</span> <span class="token punctuation">[</span>PID<span class="token punctuation">]</span>
$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>如成功连接 <code>venus-gateway</code>，您将看到以下日志。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2021</span>-07-12T15:14:12.457+0800    INFO    wallet_event    wallet_event/listenevent.go:197 connect to server fcf714b2-eeb6-498b-aafc-5e58eccd9d0f  <span class="token punctuation">{</span><span class="token string">&quot;api hub&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/ip4/&lt;IP_ADDRESS&gt;/tcp/45132&quot;</span><span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>建议使用<code>systemd</code>或<code>supervisord</code>等线程控制。</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请确保venus-wallet 处于unlocked状态，要么会在Sealer模块初始化时卡在 &quot;Waiting for confirmation&quot;，导致miner帐号生成不了。</p></div> <h2 id="安装venus-sealer"><a href="#安装venus-sealer" class="header-anchor">#</a> 安装venus-sealer</h2> <p>下载并编译<code>venus-sealer</code>的源代码。</p> <ul><li>首次编译</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-sealer.git
$ <span class="token builtin class-name">cd</span> venus-sealer
$ <span class="token function">git</span> checkout -b incubation origin/incubation
<span class="token comment"># specify source compilation</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">RUSTFLAGS</span><span class="token operator">=</span><span class="token string">&quot;-C target-cpu=native -g&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FFI_BUILD_FROM_SOURCE</span><span class="token operator">=</span><span class="token number">1</span>
$ <span class="token function">make</span> deps
$ <span class="token function">make</span>
</code></pre></div><p>源码编译也可以</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token assign-left variable">RUSTFLAGS</span><span class="token operator">=</span><span class="token string">&quot;-C target-cpu=native -g&quot;</span> <span class="token assign-left variable">FFI_BUILD_FROM_SOURCE</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token function">make</span> deps
</code></pre></div><ul><li>曾经成功编译过</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> fetch
$ <span class="token function">git</span> pull

<span class="token comment"># Update and compile filecoin-ffi, if filecoin-ffi has not changed, no need to execute</span>
$ <span class="token function">git</span> submodule update --init --recursive
$ <span class="token function">make</span> clean
$ <span class="token function">make</span> deps

$ <span class="token function">make</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>确保编译时使用<code>RUSTFLAGS=&quot;-C target-cpu=native -g&quot; FFI_BUILD_FROM_SOURCE=&quot;1&quot;</code> 源码编译filecoin-ffi库，如果cpu支持则启用SHA扩展，这会大幅提高扇区封装速度，源码编译（make deps）时特征如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>+ trap '{ rm -f $__build_output_log_tmp; }' EXIT
+ local '__rust_flags=--print native-static-libs -C target-feature=+sse2'
+ RUSTFLAGS='--print native-static-libs -C target-feature=+sse2'
+ cargo +nightly-2021-04-24 build --release --no-default-features --features multicore-sdr --features pairing,gpu
+ tee /tmp/tmp.IYtnd3xka9
   Compiling autocfg v1.0.1
   Compiling libc v0.2.97
   Compiling cfg-if v1.0.0
   Compiling proc-macro2 v1.0.27
   Compiling unicode-xid v0.2.2
   Compiling syn v1.0.73
   Compiling lazy_static v1.4.0
   Compiling cc v1.0.68
   Compiling typenum v1.13.0
   Compiling serde_derive v1.0.126
   Compiling serde v1.0.126
</code></pre></div></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果您是第一次运行sealer，它会开始下载证明参数，这可能需要相当长的时间。如果您确认已下载<code>proof params</code>，可使用<code>TRUST_PARAMS=1</code>跳过下载逻辑执行。如果您位于中国，请按照提示<a href="/zh/advanced/Tips-Running-In-China.html">此处</a>加快流程。</p></div> <h3 id="创建新的miner-id来初始化sealer"><a href="#创建新的miner-id来初始化sealer" class="header-anchor">#</a> 创建新的miner-id来初始化sealer</h3> <p>如果您还没有miner-id，请运行以下命令来初始化sealer。请确保<code>&lt;OWNER_ADDRESS&gt;</code>中有足够资金支付gasfee，否则<code>init</code>将失败。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./venus-sealer <span class="token punctuation">\</span>
<span class="token comment"># Leave out this flag for mainnet</span>
--network<span class="token operator">=</span>calibration init <span class="token punctuation">\</span>
--worker<span class="token operator">=</span><span class="token operator">&lt;</span>WORKER_ADDRESS<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--owner<span class="token operator">=</span><span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span>  <span class="token punctuation">\</span>
<span class="token comment"># Choose between 32G or 64G for mainnet</span>
--sector-size 512M <span class="token punctuation">\</span>
<span class="token comment"># Config for different shared venus modules</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS<span class="token operator">&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--messager-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS_MESSAGER<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>PORT_OF_VENUS_MESSAGER<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--gateway-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS_GATEWAY<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>PORT_OF_VENUS_GATEWAY<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--auth-token<span class="token operator">=</span><span class="token operator">&lt;</span>AUTH_TOKEN_FOR_ACCOUNT_NAME<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
<span class="token comment"># Flags sealer to not storing any sealed sectors on the machine it runs on</span>
<span class="token comment"># You can leave out this flag if you are on testnet</span>
--no-local-storage <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>以下为成功创建<code>&lt;MINER_ID&gt;</code>的日志。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2021</span>-07-12T17:02:07.199+0800	INFO	main	venus-sealer/init.go:142	Initializing venus sealer
<span class="token number">2021</span>-07-12T17:02:07.199+0800	INFO	main	venus-sealer/init.go:162	Checking proof parameters
<span class="token number">2021</span>-07-12T17:03:35.229+0800	INFO	paramfetch	go-paramfetch@v0.0.2-0.20210614165157-25a6c7769498/paramfetch.go:207	parameter and key-fetching complete
<span class="token number">2021</span>-07-12T17:03:35.229+0800	INFO	main	venus-sealer/init.go:176	Trying to connect to full node RPC
<span class="token number">2021</span>-07-12T17:03:35.592+0800	INFO	main	venus-sealer/init.go:190	Checking full node <span class="token function">sync</span> status
<span class="token number">2021</span>-07-12T17:03:35.592+0800	INFO	main	venus-sealer/init.go:198	Checking <span class="token keyword">if</span> repo exists
<span class="token number">2021</span>-07-12T17:03:35.592+0800	INFO	main	venus-sealer/init.go:210	Checking full node version
<span class="token number">2021</span>-07-12T17:03:36.099+0800	INFO	main	venus-sealer/init.go:226	Initializing repo
<span class="token number">2021</span>-07-12T17:03:36.100+0800	INFO	main	venus-sealer/init.go:339	Initializing libp2p identity
<span class="token number">2021</span>-07-12T17:03:39.022+0800	INFO	main	venus-sealer/init.go:515	Pushed CreateMiner message: 3bfd3fc8-4f8d-45c8-86e9-5fe29a02fec0
<span class="token number">2021</span>-07-12T17:03:39.022+0800	INFO	main	venus-sealer/init.go:516	Waiting <span class="token keyword">for</span> confirmation
<span class="token number">2021</span>-07-12T17:07:39.184+0800	INFO	main	venus-sealer/init.go:532	New miners address is: <span class="token operator">&lt;</span>MINER_ID<span class="token operator">&gt;</span> <span class="token punctuation">(</span>t2qgsnl5qy7sehm7u5nobkblmi2t4tuvh7flc4nqy<span class="token punctuation">)</span>
<span class="token number">2021</span>-07-12T17:07:39.184+0800	INFO	main	venus-sealer/init.go:411	Created new miner: <span class="token operator">&lt;</span>MINER_ID<span class="token operator">&gt;</span>
<span class="token number">2021</span>-07-12T17:07:39.185+0800	INFO	main	venus-sealer/init.go:295	Sealer successfully created, you can now start it with <span class="token string">'venus-sealer run'</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>init</code>命令会发送创建矿工消息并等待上链，可能需要等待几分钟。</p></div> <h3 id="使用现有的miner-id初始化sealer"><a href="#使用现有的miner-id初始化sealer" class="header-anchor">#</a> 使用现有的miner-id初始化sealer</h3> <p>如果您已经有miner-id，请运行以下命令来初始化sealer。请确保<code>&lt;OWNER_ADDRESS&gt;</code>中有足够资金支付gasfee，否则<code>init</code>将失败。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer 
<span class="token comment"># Leave out this flag for mainnet</span>
--network<span class="token operator">=</span>calibration init <span class="token punctuation">\</span>
--actor<span class="token operator">=</span><span class="token operator">&lt;</span>MINER_ID<span class="token operator">&gt;</span>  <span class="token punctuation">\</span>
<span class="token comment"># Config for different shared venus modules</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS<span class="token operator">&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--messager-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS_MESSAGER<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>PORT_OF_VENUS_MESSAGER<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--gateway-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>IP_ADDRESS_OF_VENUS_GATEWAY<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>PORT_OF_VENUS_GATEWAY<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--auth-token<span class="token operator">=</span><span class="token operator">&lt;</span>AUTH_TOKEN_FOR_ACCOUNT_NAME<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
<span class="token comment"># Flags sealer to not store any sealed sectors on the machine it runs on</span>
--no-local-storage <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>以下为成功init日志的范例。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2021</span>-06-07T04:15:49.170+0800    INFO    main    venus-sealer/init.go:193        Checking <span class="token keyword">if</span> repo exists
<span class="token number">2021</span>-06-07T04:15:49.170+0800    INFO    main    venus-sealer/init.go:205        Checking full node version
<span class="token number">2021</span>-06-07T04:15:49.174+0800    INFO    main    venus-sealer/init.go:221        Initializing repo
<span class="token number">2021</span>-06-07T04:15:49.175+0800    INFO    main    venus-sealer/init.go:334        Initializing libp2p identity
<span class="token number">2021</span>-06-07T04:15:49.181+0800    INFO    main    venus-sealer/init.go:406        Created new miner: t02105
<span class="token number">2021</span>-06-07T04:15:49.181+0800    INFO    main    venus-sealer/init.go:290        Sealer successfully created, you can now start it with <span class="token string">'venus-sealer run'</span>
</code></pre></div><h2 id="开始封装"><a href="#开始封装" class="header-anchor">#</a> 开始封装</h2> <p>运行sealer。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./venus-sealer run <span class="token operator">&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>给sealer指定临时路径（存放p1-c2阶段生成文件，sector完成后会释放）和持久存储路径（用于做winningPoSt或wdPoSt的文件需要持久保存）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer storage attach --init --store <span class="token operator">&lt;</span>ABSOLUTE_PATH_OF_YOUR_PERMANENT_STORAGE<span class="token operator">&gt;</span>
$ ./venus-sealer storage attach --init --seal <span class="token operator">&lt;</span>ABSOLUTE_PATH_OF_YOUR_SEALING_STORAGE<span class="token operator">&gt;</span>
</code></pre></div><p>如果你的两个目录是相同的，那么可以一次性指定</p> <div class="language- extra-class"><pre class="language-text"><code>./venus-sealer storage attach --init --store --seal &lt;ABSOLUTE_PATH&gt;
</code></pre></div><blockquote><p><code>--groups / --allow-to</code> 用于将worker分组，介绍见后文。</p></blockquote> <blockquote><p>如果你打算只用venus-sealer封装扇区，那么seal和store路径必须都配置，缺一不可。</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer storage list
37109bd3-15cc-4821-99e8-b7af891f2e84:
        <span class="token punctuation">[</span><span class="token comment">####################***                           ] 4.82 TiB/10.39 TiB 46%</span>
        Unsealed: <span class="token number">2</span><span class="token punctuation">;</span> Sealed: <span class="token number">1</span><span class="token punctuation">;</span> Caches: <span class="token number">1</span><span class="token punctuation">;</span> Reserved: <span class="token number">483.2</span> GiB
        Weight: <span class="token number">10</span><span class="token punctuation">;</span> Use: Seal 
        URL: http://127.0.0.1:3456/remote <span class="token punctuation">(</span>latency: <span class="token number">9</span>.1ms<span class="token punctuation">)</span>
f4074188-c851-4468-820b-e138beb5f12d:
        <span class="token punctuation">[</span><span class="token comment">####################                              ] 4.348 TiB/10.39 TiB 41%</span>
        Unsealed: <span class="token number">1</span><span class="token punctuation">;</span> Sealed: <span class="token number">8</span><span class="token punctuation">;</span> Caches: <span class="token number">8</span><span class="token punctuation">;</span> Reserved: <span class="token number">0</span> B
        Weight: <span class="token number">10</span><span class="token punctuation">;</span> Use: Seal Store
        Local: /mnt/mount/litao/
        URL: http://192.168.200.17:2345/remote
</code></pre></div><p>封装一个扇区。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer sectors pledge 
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果遇到如下错误, 请复制一个已经生成的unsealed文件(<code>~/.venussealer/unsealed/</code>) 到 <code>/var/tmp/s-basic-unsealed-34359738368</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2021</span>-09-01T10:41:10.394+0200    WARN    sectors storage-sealing/fsm.go:626      sector <span class="token number">611</span> got error event sealing.SectorSealPreCommit1Failed: seal pre commit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> failed: storage call error <span class="token number">0</span>: The default unsealed does not exist,please copy a generated unsealed <span class="token function">file</span> to /var/tmp/s-basic-unsealed-34359738368
</code></pre></div><p>我们建议先生成一个unsealed文件后拷贝到每个做 P1 任务的worker机器/var/tmp目录,文件的命令规则:</p> <ul><li>s-basic-unsealed-<em><strong>SectorSize</strong></em></li> <li>s-piece-infos-<em><strong>SectorSize</strong></em></li></ul> <p>SectorSize 选项: 2048,8388608,536870912,34359738368,68719476736,eg. 32G:</p> <div class="language- extra-class"><pre class="language-text"><code>/var/tmp/s-piece-infos-34359738368
/var/tmp/s-basic-unsealed-34359738368
</code></pre></div><p>不同SectorSize对应的s-piece-infos-***SectorSize***文件内容:</p> <div class="language- extra-class"><pre class="language-text"><code># 32G
[{&quot;Size&quot;:34359738368,&quot;PieceCID&quot;:{&quot;/&quot;:&quot;baga6ea4seaqao7s73y24kcutaosvacpdjgfe5pw76ooefnyqw4ynr3d2y6x2mpq&quot;}}]

# 8M
[{&quot;Size&quot;:8388608,&quot;PieceCID&quot;:{&quot;/&quot;:&quot;baga6ea4seaqgl4u6lwmnerwdrm4iz7ag3mpwwaqtapc2fciabpooqmvjypweeha&quot;}}]

# 512M
[{&quot;Size&quot;:536870912,&quot;PieceCID&quot;:{&quot;/&quot;:&quot;baga6ea4seaqdsvqopmj2soyhujb72jza76t4wpq5fzifvm3ctz47iyytkewnubq&quot;}}]

# 2k
[{&quot;Size&quot;:2048,&quot;PieceCID&quot;:{&quot;/&quot;:&quot;baga6ea4seaqpy7usqklokfx2vxuynmupslkeutzexe2uqurdg5vhtebhxqmpqmy&quot;}}]

# 64G
[{&quot;Size&quot;:68719476736,&quot;PieceCID&quot;:{&quot;/&quot;:&quot;baga6ea4seaqomqafu276g53zko4k23xzh4h4uecjwicbmvhsuqi7o4bhthhm4aq&quot;}}]
</code></pre></div></div> <p>一般启动一个脚本或系统事务用于发任务,最好是相隔一段时间发一个任务。为了避免任务数过多导致系统卡顿，需要控制sector的任务上限(MaxSealingSectors)。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">vim</span> ~/.venussealer/config.toml 

<span class="token punctuation">[</span>Sealing<span class="token punctuation">]</span>
  <span class="token punctuation">..</span>.
  MaxSealingSectors <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><p>检查正在进行的封装工作</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer sealing
$ ./venus-sealer sealing workers
$ ./venus-sealer sealing <span class="token function">jobs</span>
</code></pre></div><p>检查扇区状态</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer sectors list
$ ./venus-sealer sectors status  --log  <span class="token operator">&lt;</span>sectorNum<span class="token operator">&gt;</span>
</code></pre></div><p>如果某个扇区因为ticket过期或别的原因无法继续做下去，你需要及时remove掉，不然会占着磁盘和任务数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Terminating -&gt; TerminateWait -&gt; TerminateFinality/TerminateFailed</span>
$ ./venus-sealer sectors terminate  --really-do-it <span class="token operator">&lt;</span>sectorNum<span class="token operator">&gt;</span>
<span class="token comment"># Removing -&gt; RemoveFailed/Removed</span>
$ ./venus-sealer sectors remove  --really-do-it <span class="token operator">&lt;</span>sectorNum<span class="token operator">&gt;</span>
</code></pre></div><p>Remove和Terminate执行受限于Sealing的并发机制，有时需要很长时间，你可以尝试多次执行这两个命令加快速度。查看Sector状态：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sealer sectors list
ID  State       OnChain  Active  Expiration                    Deals
<span class="token number">1</span>   Proving     YES      YES     <span class="token number">2513094</span> <span class="token punctuation">(</span>in <span class="token number">1</span> year <span class="token number">24</span> weeks<span class="token punctuation">)</span>  CC
<span class="token number">2</span>   Removed    NO       NO      n/a                           CC
<span class="token number">3</span>   PreCommit1  NO       NO      n/a                           CC
</code></pre></div><p>设置发送消息的地址：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>Addresses<span class="token punctuation">]</span>
  PreCommitControl <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># P2</span>
  CommitControl <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># C2</span>
  DisableOwnerFallback <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment"># true 表示禁用</span>
  DisableWorkerFallback <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment"># true 表示禁用</span>
</code></pre></div><blockquote><p>P2,C2消息的from可以设置多个，但必须是miner-id相关联的，如worker，owner或controller。</p></blockquote> <h2 id="worker机制"><a href="#worker机制" class="header-anchor">#</a> worker机制</h2> <p>在Filecoin系统中,venus-sealer可以被认为是一个带有状态管理机的venus-worker，也就是说:</p> <p>sealer = worker + sector_state_manager</p> <p>除了做worker具备的工作外，它有两个主要功能:</p> <ul><li>管理每个扇区的状态，包括分配扇区任务，处理与扇区状态变化的事件等;</li> <li>定期执行windowPost.</li></ul> <p>因此，我们通常将耗时的任务交给venus-worker做，让sealer做windowPoSt和Sectors状态管理。这样做的好处是:venus-sealer重启后，不会影响到worker正在进行的任务,否则会导致仍无频繁重做.</p> <ul><li>只允许venus-sealer做AddPiece，禁止做P1, P2, C1, C2等任务，修改` ~/.venussealer/config.toml ', 然后重启.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span>  ~/.venussealer/config.toml 
<span class="token comment"># modify</span>
<span class="token punctuation">[</span>Storage<span class="token punctuation">]</span>
  ParallelFetchLimit <span class="token operator">=</span> <span class="token number">10</span>
  AllowAddPiece <span class="token operator">=</span> <span class="token boolean">true</span>
  AllowPreCommit1 <span class="token operator">=</span> <span class="token boolean">false</span>
  AllowPreCommit2 <span class="token operator">=</span> <span class="token boolean">false</span>
  AllowCommit <span class="token operator">=</span> <span class="token boolean">false</span>
  AllowUnseal <span class="token operator">=</span> <span class="token boolean">false</span>
  
<span class="token comment"># Restart venus-sealer after saving</span>
</code></pre></div><p>-- 启动worker并指定可以接的任务类型.</p> <div class="language- extra-class"><pre class="language-text"><code>$ TRUST_PARAMS=1 nohup ./venus-worker run \
--miner-addr=&lt;/ip4/sealer-ip/tcp/sealer-port&gt; \
--miner-token=&lt;token&gt; \
--task-total=100 \
--listen=&lt;0.0.0.0:3458&gt; &lt;flags&gt; &gt; worker.log 2&gt;&amp;1 &amp;           
</code></pre></div><ul><li>sealer-port: cat ~/.venussealer/api, eg. /ip4/0.0.0.0/tcp/2345/http,把0.0.0.0替换为venus-sealer实际的IP地址.</li> <li>token: cat ~/.venussealer/token</li> <li>flags:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>--addpiece                    enable addpiece (default: true)
--precommit1                  enable precommit1 (32G sectors: 1 core, 128GiB RAM) (default: true)
--unseal                      enable unsealing (32G sectors: 1 core, 128GiB RAM) (default: true)
--precommit2                  enable precommit2 (32G sectors: multiple cores, 96GiB RAM) (default: true)
--commit                      enable commit (32G sectors: multiple cores or GPUs, 128GiB RAM + 64GiB swap) (default: true)
--task-total                  total number of task (default: 100)
</code></pre></div><ul><li><em><strong>task-total为可同时进行的任务数,默认100;</strong></em></li></ul> <p>一般情况下，我们只为venus-worker配置seal路径,Store继承venus-sealer。worker完成扇区密封时，永久存储文件将被转移到venus-sealer指定的store路径.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-worker storage attach --init --seal <span class="token operator">&lt;</span>ABSOLUTE_LOCAL_PATH<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p><code>--groups / --allow-to</code> 用于将worker分组，介绍见后文。</p></blockquote> <h3 id="多worker注意事项"><a href="#多worker注意事项" class="header-anchor">#</a> 多worker注意事项</h3> <ul><li>TMPDIR指定worker的临时目录，比如gpu的文件锁就会生成在此路径下，worker运行在同一机器上时需要指定不同的TMPDIR，否则会竞争文件锁；</li> <li>多个worker在同一机器同用户创建时需要指定不同的库目录，需要带repo flag，形式：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token assign-left variable">TRUST_PARAMS</span><span class="token operator">=</span><span class="token number">1</span> <span class="token function">nohup</span> ./venus-worker --repo<span class="token operator">=</span><span class="token operator">&lt;</span>REPO_PATH<span class="token operator">&gt;</span> run <span class="token punctuation">\</span>
--miner-addr<span class="token operator">=</span><span class="token operator">&lt;</span>/ip4/sealer-ip/tcp/sealer-port<span class="token operator">&gt;</span> --miner-token<span class="token operator">=</span><span class="token operator">&lt;</span>token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--listen<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token number">0.0</span>.0.0:345<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> <span class="token operator">&lt;</span>flags<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> worker.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>查看venus-worker状态</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-worker info

<span class="token comment"># A worker's storage will be added to the venus-sealer storage list</span>
$ ./venus-sealer storage list 
01135ade-337a-4011-9cd8-6e85edbe08fc:
        <span class="token punctuation">[</span><span class="token comment">#######                                           ] 26.52 TiB/181.2 TiB 14%</span>
        Unsealed: <span class="token number">0</span><span class="token punctuation">;</span> Sealed: <span class="token number">1080</span><span class="token punctuation">;</span> Caches: <span class="token number">1080</span><span class="token punctuation">;</span> Reserved: <span class="token number">0</span> B
        Weight: <span class="token number">10</span><span class="token punctuation">;</span> Use: Seal Store
        Local: /storage-nfs/torage
        URL: http://0.0.0.0:2345/remote
14142f91-6365-4b2a-ad1b-d2dd4ebd6e33:
        <span class="token punctuation">[</span><span class="token comment">###################                               ] 4.044 TiB/10.39 TiB 38%</span>
        Unsealed: <span class="token number">3</span><span class="token punctuation">;</span> Sealed: <span class="token number">0</span><span class="token punctuation">;</span> Caches: <span class="token number">0</span><span class="token punctuation">;</span> Reserved: <span class="token number">0</span> B
        Weight: <span class="token number">10</span><span class="token punctuation">;</span> Use: Seal 
        URL: http://192.168.200.17:3458/remote <span class="token punctuation">(</span>latency: <span class="token number">1</span>.2ms<span class="token punctuation">)</span>
</code></pre></div><h3 id="存储分组"><a href="#存储分组" class="header-anchor">#</a> 存储分组</h3> <p><code>--groups / --allow-to</code> 用于 <code>venus-sealer/venus-worker storage attach</code> 命令，允许创建工作组，并避免在多venus-worker之间不必要地移动数据。例如在以下设置中：</p> <ul><li>venus-sealer
<ul><li>Groups：[&quot;example-storage-group-1&quot;]</li></ul></li> <li>venus-worker 1（PC1、PC2）：
<ul><li>Groups：[&quot;example-seal-group-1&quot;]，AllowTo: [&quot;example-seal-group-1&quot;]</li></ul></li> <li>venus-worker 2（PC1、PC2）：
<ul><li>Groups：[“example-seal-group-2”]，AllowTo：[“example-seal-group-2”]</li></ul></li> <li>venus-worker 3 (PC1)：
<ul><li>AllowTo：[&quot;example-seal-group-1&quot;]</li></ul></li></ul> <p>如果没有存储组，worker 1/2 上的 PC2 任务可以使用来自其他 worker 的扇区数据进行调度，这通常会浪费带宽，并且偶尔会在获取数据时阻塞处理。</p> <p>使用如上配置的存储组，在 worker1/worker2 上完成 PC1 的扇区将始终在同一个 worker 上执行 PC2。来自 worker3 的扇区将只转到 worker1 以获取 PC2。</p> <p>可以通过两种方式设置组：</p> <ul><li>对于现在的存储路径，当使用带有新 <code>--groups / --allow-to</code> 标志的 <code>storage attach --init</code> 命令时。</li> <li>对于现有的存储路径 - 通过修改 [path]/sectorstore.json，然后重新启动 venus-miner/venus-worker。</li></ul> <p>Groups:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;ID&quot;: &quot;74e1d667-7bc9-49bc-a9a6-0c30afd8684c&quot;,
  &quot;Weight&quot;: 10,
  &quot;CanSeal&quot;: false,
  &quot;CanStore&quot;: true,
  &quot;MaxStorage&quot;: 0,
  &quot;Groups&quot;: [&quot;storage0&quot;]
}
</code></pre></div><p>AllowTo:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;ID&quot;: &quot;54f090bf-9fa9-4a47-9f67-0cc4f24c810e&quot;,
  &quot;Weight&quot;: 10,
  &quot;CanSeal&quot;: true,
  &quot;CanStore&quot;: false,
  &quot;AllowTo&quot;: [&quot;storage0&quot;]
}
</code></pre></div><ul><li>如何让同一台机器的worker（PC2）只接收本机PC1完成的扇区任务？
所有worker的<code>storage attach</code>时设置相同的 <code>--groups</code> 和<code>--allow-to</code>，并指定相同的 <code>seal</code> 目录 。</li></ul> <h2 id="加速项配置"><a href="#加速项配置" class="header-anchor">#</a> 加速项配置</h2> <p>如果您的系统硬件资源足够大，或者拥有GPU等可以加快扇区密封的资源,您可以根据实际环境设置环境变量。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># MINER_API_INFO as obtained before</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>/fast/disk/folder3                    <span class="token comment"># used when sealing</span>
<span class="token builtin class-name">export</span> MINER_API_INFO:<span class="token operator">&lt;</span>TOKEN<span class="token operator">&gt;</span>:/ip4/<span class="token operator">&lt;</span>miner_api_address<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>/http`
<span class="token builtin class-name">export</span> <span class="token assign-left variable">BELLMAN_CPU_UTILIZATION</span><span class="token operator">=</span><span class="token number">0.875</span>      <span class="token comment"># optimal value depends on exact hardware</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span><span class="token operator">=</span><span class="token number">1</span> <span class="token comment"># when GPU is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_GPU_TREE_BUILDER</span><span class="token operator">=</span><span class="token number">1</span>   <span class="token comment"># when GPU is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_PARAMETER_CACHE</span><span class="token operator">=</span>/fast/disk/folder <span class="token comment"># &gt; 100GiB!</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_PARENT_CACHE</span><span class="token operator">=</span>/fast/disk/folder2   <span class="token comment"># &gt; 50GiB!</span>
<span class="token comment"># The following increases speed of PreCommit1 at the cost of using a full</span>
<span class="token comment"># CPU core-complex rather than a single core.</span>
<span class="token comment"># See https://github.com/filecoin-project/rust-fil-proofs/ and the</span>
<span class="token comment"># &quot;Worker co-location&quot; section below.</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_MULTICORE_SDR</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><p>venus-worker使用了一个GPU程序，在双卡3080机器上运行，程序会自动搜寻并使用0号和1号GPU卡。性能测试要求程序只运行在一张GPU卡上，但程序没有参数设置GPU的地方。
采取CUDA环境变量CUDA_VISIBLE_DEVICES来限定程序运行的GPU设备解决问题:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// CUDA_VISIBLE_DEVICES设置说明，设置device对程序可见
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">1</span>       // 仅使用device1 <span class="token punctuation">(</span>即卡一<span class="token punctuation">)</span>
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,1</span>     // 仅使用device <span class="token number">0</span>和 device1
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token string">&quot;0,1&quot;</span>	 // 同上, 仅使用device <span class="token number">0</span>和 device1
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,2</span>,3   // 仅使用device <span class="token number">0</span>, device2和device3
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">2,0</span>,3   // 仅使用device0, device2和device3
</code></pre></div><p>可以通过以下变量来提升显卡GPU内存的使用率，减少P2任务的用时
FIL_PROOFS_MAX_GPU_COLUMN_BATCH_SIZE  -  每次计算Column的batch大小，默认400000;
FIL_PROOFS_MAX_GPU_TREE_BATCH_SIZE  -   每次Encoding计算的batch大小，默认700000</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 建议值
<span class="token assign-left variable">FIL_PROOFS_MAX_GPU_COLUMN_BATCH_SIZE</span><span class="token operator">=</span><span class="token number">8000000</span>,FIL_PROOFS_MAX_GPU_TREE_BATCH_SIZE<span class="token operator">=</span><span class="token number">8000000</span>
</code></pre></div><p>这些变量的使用有两种方式：</p> <ul><li>在启动venus-sealer和venus-worker前 export设置,如我想开启cpu多核计算</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_MULTICORE_SDR</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token function">nohup</span> ./venus-sealer run <span class="token operator">&gt;&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><ul><li>在启动命令中使用环境变量</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">FIL_PROOFS_USE_MULTICORE_SDR</span><span class="token operator">=</span><span class="token number">1</span> <span class="token function">nohup</span> ./venus-worker run <span class="token operator">&gt;&gt;</span> worker.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p><em><strong>关于GPU的使用</strong></em></p> <ul><li>C2阶段会主动搜索机器是否有可用GPU，有则使用；</li> <li>P2阶段在生成tree-c和tree-r-last阶段可以使用gpu加速，但需要在启动对应sealer或worker时配置环境变量：FIL_PROOFS_USE_GPU_COLUMN_BUILDER=1表示生成tree-r-last阶段使用GPU，FIL_PROOFS_USE_GPU_TREE_BUILDER=1表示生成tree-c阶段使用GPU。</li></ul> <p>参考文档</p> <ul><li>https://docs.filecoin.io/mine/lotus/miner-troubleshooting/</li> <li>https://docs.filecoin.io/get-started/lotus/installation/#linux</li> <li>https://docs.filecoin.io/mine/lotus/miner-setup/#pre-requisites</li> <li>https://github.com/filecoin-project/venus-docs/blob/master/docs/zh/mine/venus/power_growth_and_maintain.md</li></ul> <h2 id="lotus-miner"><a href="#lotus-miner" class="header-anchor">#</a> lotus-miner</h2> <p>   如果你已经用lotus-miner密封了一定数量的扇区，我们建议你继续使用lotus-miner，venus社区同步维护可接入共享组件的lotus-miner：https://github.com/ipfs-force-community/lotus，对于lotus官方的每个大版本，我们会同步发布对应版本。</p> <p>   这个分支只是将对接共享组件的逻辑加进来，其他逻辑一切没变，你可以按照原有的习惯去执行lotus-miner。</p> <h3 id="已有算力集群处理"><a href="#已有算力集群处理" class="header-anchor">#</a> 已有算力集群处理</h3> <p>  等待lotus-miner正在做的扇区完成后执行下列流程：</p> <ol><li><p>停止lotus-miner，因为默认lotus-miner和venus-sealer都是用的2345端口；</p></li> <li><p>初始化venus-sealer，--actor 指定原来的矿工地址；</p></li> <li><p>启动venus-sealer后，使用venus-sealer storage attach --store 来指定原来数据存储的路径；</p></li> <li><p>修改默认下发sector id的数值,导入lotus-miner下发的扇区：</p></li></ol> <p>   如果想继续增长算力,需要修改扇区nextid的值&gt;已完成扇区的最大ID;想在venus-sealer查看已有的扇区,需要从lotus-miner导入,具体方法如下:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./lotus-convert -lotus-miner-repo<span class="token operator">=</span>/root/.lotusminer/ -venus-sealer-repo<span class="token operator">=</span>/root/.venussealer -taskType<span class="token operator">=</span><span class="token number">0</span> -sid<span class="token operator">=</span><span class="token number">10</span>
</code></pre></div><p><code>taskType</code>: 0-只修改nextid,1-只导入扇区,2-都做; <code>sid</code>: 默认是0,这时会从源仓库中查找最大扇区的ID写入nextid,其他值-以指定的值修改nextid,举例如下:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 只修改nextid=300</span>
./lotus-convert -lotus-miner-repo<span class="token operator">=</span>/root/.lotusminer/ -venus-sealer-repo<span class="token operator">=</span>/root/.venussealer -taskType<span class="token operator">=</span><span class="token number">0</span> -sid<span class="token operator">=</span><span class="token number">300</span>

<span class="token comment"># 仅导入扇区</span>
./lotus-convert -lotus-miner-repo<span class="token operator">=</span>/root/.lotusminer/ -venus-sealer-repo<span class="token operator">=</span>/root/.venussealer -taskType<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 导入扇区并修改nextid为已有扇区最大的ID</span>
./lotus-convert -lotus-miner-repo<span class="token operator">=</span>/root/.lotusminer/ -venus-sealer-repo<span class="token operator">=</span>/root/.venussealer -taskType<span class="token operator">=</span><span class="token number">2</span>
</code></pre></div><h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题?</h2> <p>来<a href="https://filecoinproject.slack.com/archives/CEHHJNJS3" target="_blank" rel="noopener noreferrer">Slack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上找我们吧！</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/guide/Using-venus-Shared-Modules.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/12/16 下午3:36:07</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/guide/How-To-Deploy-MingPool.html" class="prev">
        部署存储池
      </a></span> <span class="next"><a href="/zh/guide/Using-venus-market.html">
        发送接收订单
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.44eba00d.js" defer></script><script src="/assets/js/2.2da8aaea.js" defer></script><script src="/assets/js/18.78dd5e68.js" defer></script>
  </body>
</html>
