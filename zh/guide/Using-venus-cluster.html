<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | 启明星</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/venus-logo.png">
    <meta name="description" content="GO语言实现的Filecoin分布式存储网络">
    
    <link rel="preload" href="/assets/css/0.styles.0f69d946.css" as="style"><link rel="preload" href="/assets/js/app.ca3019b1.js" as="script"><link rel="preload" href="/assets/js/2.1f1c6e1f.js" as="script"><link rel="preload" href="/assets/js/99.3718c5fc.js" as="script"><link rel="prefetch" href="/assets/js/10.489a4dcb.js"><link rel="prefetch" href="/assets/js/100.73ff1237.js"><link rel="prefetch" href="/assets/js/101.fe2d0134.js"><link rel="prefetch" href="/assets/js/102.534c5d2e.js"><link rel="prefetch" href="/assets/js/103.98da1bf8.js"><link rel="prefetch" href="/assets/js/104.5015d12a.js"><link rel="prefetch" href="/assets/js/105.0f643ee5.js"><link rel="prefetch" href="/assets/js/106.203c4095.js"><link rel="prefetch" href="/assets/js/107.c9dc500c.js"><link rel="prefetch" href="/assets/js/108.0647978f.js"><link rel="prefetch" href="/assets/js/109.48a20838.js"><link rel="prefetch" href="/assets/js/11.c912be3b.js"><link rel="prefetch" href="/assets/js/110.34952204.js"><link rel="prefetch" href="/assets/js/111.1ef70a00.js"><link rel="prefetch" href="/assets/js/112.b310af7b.js"><link rel="prefetch" href="/assets/js/113.d3263bfa.js"><link rel="prefetch" href="/assets/js/114.248aad4f.js"><link rel="prefetch" href="/assets/js/115.11c8923f.js"><link rel="prefetch" href="/assets/js/116.6d83ded2.js"><link rel="prefetch" href="/assets/js/117.454bb632.js"><link rel="prefetch" href="/assets/js/118.fc8f4f6c.js"><link rel="prefetch" href="/assets/js/119.86c32a85.js"><link rel="prefetch" href="/assets/js/12.e84fdfb4.js"><link rel="prefetch" href="/assets/js/120.93bb1a86.js"><link rel="prefetch" href="/assets/js/121.f61162c1.js"><link rel="prefetch" href="/assets/js/122.8042b9c4.js"><link rel="prefetch" href="/assets/js/123.7e9f855e.js"><link rel="prefetch" href="/assets/js/124.0e227744.js"><link rel="prefetch" href="/assets/js/125.4af07fdd.js"><link rel="prefetch" href="/assets/js/126.10198b02.js"><link rel="prefetch" href="/assets/js/127.dd1392df.js"><link rel="prefetch" href="/assets/js/128.c91b28cd.js"><link rel="prefetch" href="/assets/js/129.81b16b16.js"><link rel="prefetch" href="/assets/js/13.e43db292.js"><link rel="prefetch" href="/assets/js/130.6cad7b05.js"><link rel="prefetch" href="/assets/js/131.6a06ad8d.js"><link rel="prefetch" href="/assets/js/132.e5f10bd5.js"><link rel="prefetch" href="/assets/js/133.f8fcc3c4.js"><link rel="prefetch" href="/assets/js/134.1447e11b.js"><link rel="prefetch" href="/assets/js/135.d0b42b84.js"><link rel="prefetch" href="/assets/js/136.ee8b5c27.js"><link rel="prefetch" href="/assets/js/137.95021ef4.js"><link rel="prefetch" href="/assets/js/138.8931069c.js"><link rel="prefetch" href="/assets/js/139.c71d54ef.js"><link rel="prefetch" href="/assets/js/14.7c8666e4.js"><link rel="prefetch" href="/assets/js/140.f2a2e866.js"><link rel="prefetch" href="/assets/js/141.cc1adc0e.js"><link rel="prefetch" href="/assets/js/142.f72a4d7f.js"><link rel="prefetch" href="/assets/js/143.9df63f38.js"><link rel="prefetch" href="/assets/js/144.2102d1c3.js"><link rel="prefetch" href="/assets/js/15.6a7842d9.js"><link rel="prefetch" href="/assets/js/16.86eda29d.js"><link rel="prefetch" href="/assets/js/17.801ed23e.js"><link rel="prefetch" href="/assets/js/18.303a4f5f.js"><link rel="prefetch" href="/assets/js/19.152004c7.js"><link rel="prefetch" href="/assets/js/20.6fdf40bf.js"><link rel="prefetch" href="/assets/js/21.42a14b36.js"><link rel="prefetch" href="/assets/js/22.39f66e7f.js"><link rel="prefetch" href="/assets/js/23.dde173cb.js"><link rel="prefetch" href="/assets/js/24.52e9b118.js"><link rel="prefetch" href="/assets/js/25.603ac83e.js"><link rel="prefetch" href="/assets/js/26.f1a5c4ce.js"><link rel="prefetch" href="/assets/js/27.3f5eced6.js"><link rel="prefetch" href="/assets/js/28.9dda5241.js"><link rel="prefetch" href="/assets/js/29.afdef930.js"><link rel="prefetch" href="/assets/js/3.d65d0753.js"><link rel="prefetch" href="/assets/js/30.f2ff2ec6.js"><link rel="prefetch" href="/assets/js/31.6755cb69.js"><link rel="prefetch" href="/assets/js/32.773fbc4f.js"><link rel="prefetch" href="/assets/js/33.8a1721fe.js"><link rel="prefetch" href="/assets/js/34.4d041608.js"><link rel="prefetch" href="/assets/js/35.0407ec7a.js"><link rel="prefetch" href="/assets/js/36.a29e28d7.js"><link rel="prefetch" href="/assets/js/37.001ced74.js"><link rel="prefetch" href="/assets/js/38.7b531bef.js"><link rel="prefetch" href="/assets/js/39.4bd2eb4d.js"><link rel="prefetch" href="/assets/js/4.83c03c6f.js"><link rel="prefetch" href="/assets/js/40.6fa0e550.js"><link rel="prefetch" href="/assets/js/41.e6f7cefb.js"><link rel="prefetch" href="/assets/js/42.90adf5ec.js"><link rel="prefetch" href="/assets/js/43.702bf4d3.js"><link rel="prefetch" href="/assets/js/44.2ec01287.js"><link rel="prefetch" href="/assets/js/45.d2c80c24.js"><link rel="prefetch" href="/assets/js/46.33f0e3ca.js"><link rel="prefetch" href="/assets/js/47.e6e667bb.js"><link rel="prefetch" href="/assets/js/48.33e97343.js"><link rel="prefetch" href="/assets/js/49.b3337317.js"><link rel="prefetch" href="/assets/js/5.75552fa6.js"><link rel="prefetch" href="/assets/js/50.c0ea8b06.js"><link rel="prefetch" href="/assets/js/51.fc528199.js"><link rel="prefetch" href="/assets/js/52.ac5d18d9.js"><link rel="prefetch" href="/assets/js/53.9388b041.js"><link rel="prefetch" href="/assets/js/54.02a5c736.js"><link rel="prefetch" href="/assets/js/55.354ed878.js"><link rel="prefetch" href="/assets/js/56.882b8a55.js"><link rel="prefetch" href="/assets/js/57.48979208.js"><link rel="prefetch" href="/assets/js/58.5192038b.js"><link rel="prefetch" href="/assets/js/59.d4beb328.js"><link rel="prefetch" href="/assets/js/6.7199f43e.js"><link rel="prefetch" href="/assets/js/60.6185417e.js"><link rel="prefetch" href="/assets/js/61.1ca0cfb9.js"><link rel="prefetch" href="/assets/js/62.165dd2cb.js"><link rel="prefetch" href="/assets/js/63.089fbdab.js"><link rel="prefetch" href="/assets/js/64.5fcc3297.js"><link rel="prefetch" href="/assets/js/65.3143d855.js"><link rel="prefetch" href="/assets/js/66.5763fced.js"><link rel="prefetch" href="/assets/js/67.bec21454.js"><link rel="prefetch" href="/assets/js/68.65227cbc.js"><link rel="prefetch" href="/assets/js/69.a62c8fd7.js"><link rel="prefetch" href="/assets/js/7.99dc5680.js"><link rel="prefetch" href="/assets/js/70.0ceab54e.js"><link rel="prefetch" href="/assets/js/71.2f62b603.js"><link rel="prefetch" href="/assets/js/72.8da59faf.js"><link rel="prefetch" href="/assets/js/73.63719da9.js"><link rel="prefetch" href="/assets/js/74.9b347b9e.js"><link rel="prefetch" href="/assets/js/75.150bfeb4.js"><link rel="prefetch" href="/assets/js/76.e4f75d66.js"><link rel="prefetch" href="/assets/js/77.61203763.js"><link rel="prefetch" href="/assets/js/78.4a3d6568.js"><link rel="prefetch" href="/assets/js/79.c80c2f83.js"><link rel="prefetch" href="/assets/js/8.244bdc74.js"><link rel="prefetch" href="/assets/js/80.5e6f16d9.js"><link rel="prefetch" href="/assets/js/81.883b1493.js"><link rel="prefetch" href="/assets/js/82.24e74441.js"><link rel="prefetch" href="/assets/js/83.b91acf7a.js"><link rel="prefetch" href="/assets/js/84.b67609e3.js"><link rel="prefetch" href="/assets/js/85.2374dfdb.js"><link rel="prefetch" href="/assets/js/86.9e7cec8c.js"><link rel="prefetch" href="/assets/js/87.f8275e69.js"><link rel="prefetch" href="/assets/js/88.f407cbe9.js"><link rel="prefetch" href="/assets/js/89.a66627fe.js"><link rel="prefetch" href="/assets/js/9.b53ec802.js"><link rel="prefetch" href="/assets/js/90.ddfcb1ce.js"><link rel="prefetch" href="/assets/js/91.f84cf994.js"><link rel="prefetch" href="/assets/js/92.d020b89f.js"><link rel="prefetch" href="/assets/js/93.3a1f1642.js"><link rel="prefetch" href="/assets/js/94.79754c88.js"><link rel="prefetch" href="/assets/js/95.1dccc52f.js"><link rel="prefetch" href="/assets/js/96.27952f84.js"><link rel="prefetch" href="/assets/js/97.e9769bcb.js"><link rel="prefetch" href="/assets/js/98.7cf65e8d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0f69d946.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/Using-venus-cluster.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/guide/Using-venus-cluster.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/Using-venus-cluster.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/guide/Using-venus-cluster.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>快速上手</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/" aria-current="page" class="sidebar-link">启明星概要</a></li><li><a href="/zh/guide/How-To-Deploy-MingPool.html" class="sidebar-link">部署存储池</a></li><li><a href="/zh/guide/Using-venus-Shared-Modules.html" class="sidebar-link">加入存储池</a></li><li><a href="/zh/guide/Using-venus-market.html" class="sidebar-link">发送接收订单</a></li><li><a href="/zh/guide/fil_withdraw_and_send.html" class="sidebar-link">提取奖励</a></li><li><a href="/zh/guide/chain.html" class="sidebar-link">链维护</a></li><li><a href="/zh/guide/How-To-Connect-Network.html" class="sidebar-link">加入不同网络</a></li><li><a href="/zh/guide/How-To-Contribute-Docs.html" class="sidebar-link">贡献文档</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>   venus-cluster是venus社区开发的一套filecoin网络中负责算力增长与维持的软件。相对于venus-sealer来说，在设计中将扇区状态的维护交给了venus-worker管理，venus-sector-manager负责与链交互，提供必要的服务接口，当venus-worker需要时调用。venus-sealer自身是一个中心调度器，所有worker都需注册到venus-sealer中，每有扇区阶段性任务产生时，venus-sealer根据可用资源，任务数等条件从中选择出最优的worker派发任务。venus-cluster系统中的worker是一个个独立的个体，创建新的扇区，并完成扇区的各阶段工作直到上链，仅在过程中需要某些信息时通过rpc 接口请求venus-sector-manager获得所需信息，比如创建扇区时请求最新的SectorID，ticket等。</p> <p>   venus-cluster和venus-sealer在扇区封装方面各有优势，总的来说，venus-cluster简化了部署流程，每个worker独立自主地完成扇区的每个阶任务，降低了系统复杂性，对单台机器的性能，资源等要求较高。venus-sealer的worker部署较为灵活，一个扇区不同阶段任务可分布在多个worker完成，使资源不足的机器可以相互合作共同完成一个扇区的封装任务，但是这种部署不确定性极高，不同机器间的数据传输也有很高的不确定性，一旦出现问题，通常影响面较大，可能造成大范围的扇区任务卡死。另外，对运维技术要求较高，需要了解各阶段的用时，资源占比等。</p> <p>   在选择独立组件时应根据自身资源选择合理的方案。本文档主要介绍venus-cluster的部署，故在后续章节有关算力增长的说明将忽略venus-sealer。</p> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <p>   venus-cluster中的独立组件由venus-worker，venus-sector-manager和venus-wallet组成。</p> <ul><li>venus-worker负责扇区封装，同一扇区各阶段任务都在一个worker中完成；</li> <li>venus-sector-manager负责windowPoSt、提供链服务；</li> <li>venus-wallet提供签名服务。</li></ul> <h3 id="安装-venus-wallet"><a href="#安装-venus-wallet" class="header-anchor">#</a> 安装 venus-wallet</h3> <p>在后台运行<code>venus-wallet</code>模块。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>为<code>venus-wallet</code>设置密码。主要是为了保护钱包，在导出私钥，授权签名时需要解锁。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet setpwd
Password:******
Enter Password again:******
Password <span class="token builtin class-name">set</span> successfully
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请备份密码并妥善保存，否则重启或锁住钱包后将无法使用相关功能。每<code>venus-wallet</code>启动时带<code>--password</code>标志会自动解锁钱包,否则启动后需要手动解锁:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet unlock
Password: 

<span class="token comment"># 查看解锁状态</span>
$ ./venus-wallet lock-state
wallet state: unlocked
</code></pre></div><p>在扇区封装的过程中需要调用wallet进行签名,如果不解锁,会导致签名失败,进而导致扇区任务失败.</p></div> <p>创建owner和worker地址。（如果没有现有的 miner ID）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet new bls
<span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>WORKER_ADDRESS<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>如果在<code>Calibration</code>网络进行测试，则必须使用来自水龙头的测试币为您的所有地址提供资金，请使用此<a href="https://faucet.calibration.fildev.network/funds.html" target="_blank" rel="noopener noreferrer">水龙头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p><em><strong>配置venus-wallet接入共享服务，使用您从链服务管理员处获得的帐号信息更改 <code>~/.venus_wallet/config.toml</code>中的<code>[APIRegisterHub]</code> 部分</strong></em></p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">APIRegisterHub</span><span class="token punctuation">]</span>
<span class="token key property">RegisterAPI</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/ip4/&lt;IP_ADDRESS_OF_VENUS_GATEWAY&gt;/tcp/&lt;PORT_OF_VENUS_GATEWAY&gt;&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;AUTH_TOKEN_FOR_ACCOUNT_NAME&gt;&quot;</span>
<span class="token key property">SupportAccounts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;ACCOUNT_NAME&gt;&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>重新启动<code>venus-wallet</code>以使更改生效。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># grep [PID] of venus-wallet process</span>
$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> wallet

<span class="token comment"># kill the process and restart</span>
$ <span class="token function">kill</span> -9 <span class="token punctuation">[</span>PID<span class="token punctuation">]</span>

$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>如成功连接 <code>venus-gateway</code>，您将看到以下日志。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2021</span>-07-12T15:14:12.457+0800    INFO    wallet_event    wallet_event/listenevent.go:197 connect to server fcf714b2-eeb6-498b-aafc-5e58eccd9d0f  <span class="token punctuation">{</span><span class="token string">&quot;api hub&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/ip4/&lt;IP_ADDRESS&gt;/tcp/45132&quot;</span><span class="token punctuation">}</span>
</code></pre></div><blockquote><p>建议使用<code>systemd</code>或<code>supervisord</code>等控制自动重启。</p></blockquote> <h3 id="安装-venus-sector-manager"><a href="#安装-venus-sector-manager" class="header-anchor">#</a> 安装 venus-sector-manager</h3> <h4 id="全局-flag"><a href="#全局-flag" class="header-anchor">#</a> 全局 flag</h4> <p>   venus-sector-manager 具备两个全局 flag，分别是：</p> <ul><li>home：数据目录，用来保存本地数据，默认位于 <code>~/.venus-sector-manager</code></li> <li>net：用于选择加入的 Filecoin 网络，默认 <code>mainnet</code>, 可选项: <code>mainnet</code>，<code>testnetnet</code>，<code>2k</code>，<code>cali</code>，<code>forcenet</code>。</li></ul> <p>   初始化venus-sector-manager。</p> <div class="language-bash extra-class"><pre class="language-bash"><code> ./venus-sector-manager --net<span class="token operator">=</span>forcenet daemon init
</code></pre></div><p>生成的初始配置文件<code>~/.venus-sector-manager/sector-manager.cfg</code>内容：</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># Default config:</span>
<span class="token punctuation">[</span><span class="token table class-name">SectorManager</span><span class="token punctuation">]</span>
<span class="token comment">#  PreFetch = true</span>
<span class="token comment">#</span>
<span class="token comment">#  [[SectorManager.Miners]]</span>
<span class="token comment">#    ID = 10000</span>
<span class="token comment">#    InitNumber = 0</span>
<span class="token comment">#    MaxNumber = 10000</span>
<span class="token comment">#    Disabled = false</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span><span class="token table class-name">Commitment</span><span class="token punctuation">]</span>
<span class="token comment">#  [Commitment.DefaultPolicy]</span>
<span class="token comment">#    CommitBatchThreshold = 0</span>
<span class="token comment">#    CommitBatchMaxWait = &quot;0s&quot;</span>
<span class="token comment">#    CommitCheckInterval = &quot;0s&quot;</span>
<span class="token comment">#    EnableBatchProCommit = false</span>
<span class="token comment">#    PreCommitBatchThreshold = 0</span>
<span class="token comment">#    PreCommitBatchMaxWait = &quot;0s&quot;</span>
<span class="token comment">#    PreCommitCheckInterval = &quot;0s&quot;</span>
<span class="token comment">#    EnableBatchPreCommit = false</span>
<span class="token comment">#    PreCommitGasOverEstimation = 0.0</span>
<span class="token comment">#    ProCommitGasOverEstimation = 0.0</span>
<span class="token comment">#    BatchPreCommitGasOverEstimation = 0.0</span>
<span class="token comment">#    BatchProCommitGasOverEstimation = 0.0</span>
<span class="token comment">#    MaxPreCommitFeeCap = &quot;&quot;</span>
<span class="token comment">#    MaxProCommitFeeCap = &quot;&quot;</span>
<span class="token comment">#    MaxBatchPreCommitFeeCap = &quot;&quot;</span>
<span class="token comment">#    MaxBatchProCommitFeeCap = &quot;&quot;</span>
<span class="token comment">#    MsgConfidence = 0</span>
<span class="token comment">#  [Commitment.Miners]</span>
<span class="token comment">#    [Commitment.Miners.example]</span>
<span class="token comment">#      [Commitment.Miners.example.Controls]</span>
<span class="token comment">#        PreCommit = &quot;&quot;</span>
<span class="token comment">#        ProveCommit = &quot;&quot;</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span><span class="token table class-name">Chain</span><span class="token punctuation">]</span>
<span class="token comment">#  Api = &quot;&quot;</span>
<span class="token comment">#  Token = &quot;&quot;</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
<span class="token comment">#  Api = &quot;&quot;</span>
<span class="token comment">#  Token = &quot;&quot;</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span><span class="token table class-name">PersistedStore</span><span class="token punctuation">]</span>
<span class="token comment">#  Includes = [&quot;unavailable&quot;]</span>
<span class="token comment">#</span>
<span class="token comment">#  [[PersistedStore.Stores]]</span>
<span class="token comment">#    Name = &quot;storage name,like `100.100.10.1`&quot;</span>
<span class="token comment">#    Path = &quot;/path/to/storage/&quot;</span>
<span class="token comment">#    Strict = false</span>
<span class="token comment">#    ReadOnly = true</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span><span class="token table class-name">PoSt</span><span class="token punctuation">]</span>
<span class="token comment">#  [PoSt.Default]</span>
<span class="token comment">#    StrictCheck = false</span>
<span class="token comment">#    GasOverEstimation = 0.0</span>
<span class="token comment">#    MaxFeeCap = &quot;&quot;</span>
<span class="token comment">#    MsgCheckInteval = &quot;1m0s&quot;</span>
<span class="token comment">#    MsgConfidence = 5</span>
<span class="token comment">#  [PoSt.Actors]</span>
<span class="token comment">#    [PoSt.Actors.10000]</span>
<span class="token comment">#      Sender = &quot;t1abjxfbp274xpdqcpuaykwkfb43omjotacm2p3za&quot;</span>
<span class="token comment">#      StrictCheck = false</span>
<span class="token comment">#      GasOverEstimation = 0.0</span>
<span class="token comment">#      MaxFeeCap = &quot;&quot;</span>
<span class="token comment">#      MsgCheckInteval = &quot;1m0s&quot;</span>
<span class="token comment">#      MsgConfidence = 5</span>
</code></pre></div><p>将链服务配置更新到<code>sector-manager.cfg</code>：</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Chain</span><span class="token punctuation">]</span>
  <span class="token key property">Api</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/&lt;IP_ADDRESS_OF_VENUS&gt;/tcp/&lt;PORT_OF_VENUS&gt;&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;AUTH_TOKEN_FOR_ACCOUNT_NAME&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
  <span class="token key property">Api</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/&lt;IP_ADDRESS_OF_VENUS_MESSAGER&gt;/tcp/&lt;PORT_OF_VENUS_MESSAGER&gt;&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;AUTH_TOKEN_FOR_ACCOUNT_NAME&quot;</span>
</code></pre></div><h4 id="创建矿工"><a href="#创建矿工" class="header-anchor">#</a> 创建矿工</h4> <p>   如果已有矿工，可略过此步骤。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sector-manager --net<span class="token operator">=</span>forcenet util miner create --from<span class="token operator">=</span>t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq --sector-size<span class="token operator">=</span>512MiB 
<span class="token number">2021</span>-09-28T16:11:20.168+0800    DEBUG   policy  policy/const.go:18      NETWORK SETUP   <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;forcenet&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:11:20.185+0800    INFO    sealer  internal/util_miner.go:250      <span class="token function">wait</span> <span class="token keyword">for</span> message receipt        <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:11:50.189+0800    INFO    sealer  internal/util_miner.go:268      msg state: FillMsg      <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:11:50.189+0800    INFO    sealer  internal/util_miner.go:250      <span class="token function">wait</span> <span class="token keyword">for</span> message receipt        <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:12:20.192+0800    INFO    sealer  internal/util_miner.go:268      msg state: FillMsg      <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:12:20.192+0800    INFO    sealer  internal/util_miner.go:250      <span class="token function">wait</span> <span class="token keyword">for</span> message receipt        <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:12:50.195+0800    INFO    sealer  internal/util_miner.go:274      message landed on chain <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span>, <span class="token string">&quot;smcid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzacecejxxqdtzyyrivhc2h4pqjdfr43dwlwbbtd7kxzbbiixzmsl6k52&quot;</span>, <span class="token string">&quot;height&quot;</span><span class="token builtin class-name">:</span> <span class="token number">92099</span><span class="token punctuation">}</span>
<span class="token number">2021</span>-09-28T16:12:50.195+0800    INFO    sealer  internal/util_miner.go:285      miner actor: t01033 <span class="token punctuation">(</span>t2sqliwznayjwcjke6ypex3ox5lajcwpasg7wc2fi<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;</span>, <span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01032&quot;</span>, <span class="token string">&quot;mid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzaceb66tlt744zjrq6bvtziinlsi7vajlyux6t3rnzxx4sfjeupxliha&quot;</span>, <span class="token string">&quot;smcid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bafy2bzacecejxxqdtzyyrivhc2h4pqjdfr43dwlwbbtd7kxzbbiixzmsl6k52&quot;</span>, <span class="token string">&quot;height&quot;</span><span class="token builtin class-name">:</span> <span class="token number">92099</span><span class="token punctuation">}</span>
</code></pre></div><p>至此矿工创建成功，矿工号为：t01033，查看该矿工信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-sector-manager --net<span class="token operator">=</span>forcenet util miner info t01033
<span class="token number">2021</span>-09-28T16:19:19.236+0800    DEBUG   policy  policy/const.go:18      NETWORK SETUP   <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;forcenet&quot;</span><span class="token punctuation">}</span>
Miner: t01033
Owner: t01032
Worker: t01032
NewWorker: <span class="token operator">&lt;</span>empty<span class="token operator">&gt;</span>
Controls<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>:
WokerChangeEpoch: -1
Multiaddrs<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>:
SectorSize: <span class="token number">536870912</span>
WindowPoStPartitionSectors: <span class="token number">2</span>
</code></pre></div><h4 id="启动服务"><a href="#启动服务" class="header-anchor">#</a> 启动服务</h4> <p>   目前，miner的一些必要信息需要手动配置，暂时无法自动获取。</p> <ul><li>矿工号，sector id范围</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">SectorManager.Miners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token key property">ID</span> <span class="token punctuation">=</span> <span class="token number">1033</span> <span class="token comment"># 矿工id，eg。 t01033 -&gt; 1033 </span>
    <span class="token key property">InitNumber</span> <span class="token punctuation">=</span> <span class="token number">0</span> <span class="token comment"># min sid </span>
    <span class="token key property">MaxNumber</span> <span class="token punctuation">=</span> <span class="token number">10000</span> <span class="token comment"># max sid</span>
    <span class="token key property">Disabled</span> <span class="token punctuation">=</span> <span class="token boolean">false</span> <span class="token comment"># false: 做算力; true:仅维持算力</span>
</code></pre></div><ul><li>P2,C2消息的from配置</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Commitment.Miners</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">Commitment.Miners.1033</span><span class="token punctuation">]</span>
      <span class="token punctuation">[</span><span class="token table class-name">Commitment.Miners.1033.Controls</span><span class="token punctuation">]</span>
        <span class="token key property">PreCommit</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span> <span class="token comment"># 根据实际需求配置钱包地址</span>
        <span class="token key property">ProveCommit</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span> <span class="token comment"># 根据实际需求配置钱包地址</span>
</code></pre></div><ul><li>永久存储路径配置</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">PersistedStore.Stores</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token key property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;store-f01033&quot;</span> <span class="token comment"># 自己起的名称</span>
    <span class="token key property">Path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>  <span class="token comment"># 绝对路径</span>
</code></pre></div><ul><li>wdPoSt配置</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">PoSt.Actors</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">PoSt.Actors.1033</span><span class="token punctuation">]</span>
      <span class="token key property">Sender</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span> <span class="token comment"># 根据实际需求配置钱包地址</span>
</code></pre></div><p>确保以上信息都配置无误后启动服务:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">nohup</span> ./venus-sector-manager daemon run  --listen<span class="token operator">=</span><span class="token number">0.0</span>.0.0:1789 --poster<span class="token operator">=</span>true <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;</span> manager.log <span class="token operator">&amp;</span>
</code></pre></div><p><code>--poster</code>设置为true表示做windowPoSt,设置为false不做windowPoSt.</p> <p>刚启动时会将配置信息输出到日志:</p> <div class="language- extra-class"><pre class="language-text"><code>021-09-28T16:51:03.850+0800    INFO    dep     dep/sealer_constructor.go:69    Sector-manager initial cfg: [SectorManager]
  PreFetch = true

  [[SectorManager.Miners]]
    ID = 1033
    InitNumber = 0
    MaxNumber = 10000
    Disabled = false

[Commitment]
  [Commitment.DefaultPolicy]
    CommitBatchThreshold = 0
    CommitBatchMaxWait = &quot;0s&quot;
    CommitCheckInterval = &quot;0s&quot;
    EnableBatchProCommit = false
    PreCommitBatchThreshold = 0
    PreCommitBatchMaxWait = &quot;0s&quot;
    PreCommitCheckInterval = &quot;0s&quot;
    EnableBatchPreCommit = false
    PreCommitGasOverEstimation = 0.0
    ProCommitGasOverEstimation = 0.0
    BatchPreCommitGasOverEstimation = 0.0
    BatchProCommitGasOverEstimation = 0.0
    MaxPreCommitFeeCap = &quot;&quot;
    MaxProCommitFeeCap = &quot;&quot;
    MaxBatchPreCommitFeeCap = &quot;&quot;
    MaxBatchProCommitFeeCap = &quot;&quot;
    MsgConfidence = 0
  [Commitment.Miners]
    [Commitment.Miners.1033]
      [Commitment.Miners.1033.Controls]
        PreCommit = &quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;
        ProveCommit = &quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;
    [Commitment.Miners.example]
      [Commitment.Miners.example.Controls]
        PreCommit = &quot;&quot;
        ProveCommit = &quot;&quot;

[Chain]
  Api = &quot;/ip4/192.168.200.12/tcp/3453&quot;
  Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoibGl0YW8wNCIsInBlcm0iOiJzaWduIiwiZXh0IjoiIn0.rezCJILQkXw0hZrCYdyVVX_dB2ZqqlXWCk4izAqnld8&quot;

[Messager]
  Api = &quot;/ip4/192.168.200.12/tcp/39812&quot;
  Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoibGl0YW8wNCIsInBlcm0iOiJzaWduIiwiZXh0IjoiIn0.rezCJILQkXw0hZrCYdyVVX_dB2ZqqlXWCk4izAqnld8&quot;

[PersistedStore]
  Includes = []

  [[PersistedStore.Stores]]
    Name = &quot;store-f01033&quot;
    Path = &quot;/mnt/test&quot;
    Strict = false
    ReadOnly = false

[PoSt]
  [PoSt.Default]
    StrictCheck = false
    GasOverEstimation = 0.0
    MaxFeeCap = &quot;&quot;
    MsgCheckInteval = &quot;1m0s&quot;
    MsgConfidence = 5
  [PoSt.Actors]
    [PoSt.Actors.1033]
      Sender = &quot;t3skelnvntu5m7kb656jfvr5dfy663aru76c6pxqp4qf6madrm7s4db77ysasefohdjypmoumc3niug6xmcxuq&quot;


2021-09-28T16:51:03.859+0800    INFO    badger  v2@v2.2007.2/logger.go:46       All 0 tables opened in 0s
        {&quot;path&quot;: &quot;/home/ipfs/.venus-sector-manager/meta&quot;}
2021-09-28T16:51:03.860+0800    DEBUG   kv      kvstore/prefix_wrapper.go:26    kv wrapped      {&quot;prefix&quot;: &quot;sector-number/&quot;, &quot;prefix-len&quot;: 14}
2021-09-28T16:51:03.863+0800    INFO    badger  v2@v2.2007.2/logger.go:46       All 0 tables opened in 0s
        {&quot;path&quot;: &quot;/home/ipfs/.venus-sector-manager/offline_meta&quot;}
2021-09-28T16:51:03.863+0800    DEBUG   kv      kvstore/prefix_wrapper.go:26    kv wrapped      {&quot;prefix&quot;: &quot;sector-states/&quot;, &quot;prefix-len&quot;: 14}
2021-09-28T16:51:03.863+0800    DEBUG   kv      kvstore/prefix_wrapper.go:26    kv wrapped      {&quot;prefix&quot;: &quot;sector-states-offline/&quot;, &quot;prefix-len&quot;: 22}
2021-09-28T16:51:03.870+0800    INFO    badger  v2@v2.2007.2/logger.go:46       All 0 tables opened in 0s
        {&quot;path&quot;: &quot;/home/ipfs/.venus-sector-manager/sector-index&quot;}
2021-09-28T16:51:03.872+0800    INFO    confmgr confmgr/local_mgr.go:133        will reload sector-manager(/home/ipfs/.venus-sector-manager/sector-manager.cfg) once receive reload sig
2021-09-28T16:51:03.872+0800    INFO    confmgr confmgr/local_mgr.go:49 local conf mgr start
2021-09-28T16:51:03.874+0800    INFO    dep     dep/sealer_constructor.go:215   miner info pre-fetched  {&quot;miner&quot;: &quot;1033&quot;}
2021-09-28T16:51:03.874+0800    INFO    sealer  venus-sector-manager/server.go:38       daemon running
2021-09-28T16:51:03.874+0800    INFO    sealer  venus-sector-manager/server.go:31       trying to listen on 0.0.0.0:1789
</code></pre></div><h3 id="安装-venus-worker"><a href="#安装-venus-worker" class="header-anchor">#</a> 安装 venus-worker</h3> <h4 id="准备-cgroup"><a href="#准备-cgroup" class="header-anchor">#</a> 准备 cgroup</h4> <blockquote><p>如果不想使用限核功能，这步可以略过</p></blockquote> <p>由于 venus-worker 允许使用者启动子进程形态的 sealing 单步处理器，并通过 cgroup 对这些子进程进行资源管理，因此需要通过执行以下命令获得 cgroup 的相关操作权限：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./create-cgroup.sh
</code></pre></div><p>注意：此脚本将为特定的 cgroup 资源组分配当前用户的执行权限。这也就意味着，如果使用者打算用特定的用户启动 venus-cluster，需要先切换到目标用户再执行脚本。</p> <h4 id="准备seal目录"><a href="#准备seal目录" class="header-anchor">#</a> 准备seal目录</h4> <p>本地目录用于保存 <code>PoRep</code> 过程中产生的文件。<code>venus-worker</code> 的设计理念是<em>按需配置</em>， 即配置与计算资源相匹配的本地存储资源，以让所有活跃中的扇区能够相互独立、并行不悖。</p> <p>使用者通过以下方式来初始化将要使用的本地目录：</p> <div class="language- extra-class"><pre class="language-text"><code>./venus-worker store seal-init -l [&lt;path/to/local/store1&gt; &lt;path/to/local/store2&gt; &lt;path/to/local/store3&gt;]
</code></pre></div><p>这里可以设置多个路径，多少个路径代表可同时做多少个sector，如创建一个sector选择的路径&lt;path/to/local/store1&gt;，则这个sector的所有临时文件都在此目录。执行后目录结构变化如下：</p> <div class="language- extra-class"><pre class="language-text"><code>$ ls -al seal/
total 16
drwxrwxr-x 4 ipfs ipfs 4096 Sep 28 17:10 .
drwxr-xr-x 8 ipfs ipfs 4096 Sep 28 17:04 ..
drwxrwxr-x 4 ipfs ipfs 4096 Sep 28 17:10 seal_01
drwxrwxr-x 4 ipfs ipfs 4096 Sep 28 17:10 seal_02

$ ls -al seal/seal_01
total 16
drwxrwxr-x 4 ipfs ipfs 4096 Sep 28 17:10 .
drwxrwxr-x 4 ipfs ipfs 4096 Sep 28 17:10 ..
drwxrwxr-x 2 ipfs ipfs 4096 Sep 28 17:10 data
-rw-rw-r-- 1 ipfs ipfs    0 Sep 28 17:10 .holder
drwxrwxr-x 2 ipfs ipfs 4096 Sep 28 17:10 meta
</code></pre></div><h4 id="配置store目录"><a href="#配置store目录" class="header-anchor">#</a> 配置store目录</h4> <p>持久化目录用于保存 <code>PoRep</code> 的结果文件。</p> <p>常见的做法是将存储服务器的对应目录挂载到本地。为了避免在丢失挂载点的情况下启动，也需要对持久化目录进行初始化。</p> <p>具体做法是在成功挂载之后，通过以下方式来初始化持久化目录：</p> <div class="language- extra-class"><pre class="language-text"><code>./venus-worker store file-init -l &lt;path/to/remote/store&gt;
</code></pre></div><p>执行后会在目录变化：</p> <div class="language- extra-class"><pre class="language-text"><code>ls -al &lt;path/to/remote/store&gt;
total 8
drwxrwxrwx 2 ipfs ipfs 4096 Sep 28 17:12 .
drwxr-xr-x 3 root root 4096 Sep 28 16:26 ..
-rw-rw-r-- 1 ipfs ipfs    0 Sep 28 17:12 .holder
</code></pre></div><h4 id="准备配置文件"><a href="#准备配置文件" class="header-anchor">#</a> 准备配置文件</h4> <p>配置文件使用 toml 格式</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># venus-sector-manager 的服务地址</span>
<span class="token punctuation">[</span><span class="token table class-name">sealer_rpc</span><span class="token punctuation">]</span>
<span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">&quot;ws://127.0.0.1:1789/rpc/v0&quot;</span>

<span class="token comment"># sealing 过程配置</span>
<span class="token punctuation">[</span><span class="token table class-name">sealing</span><span class="token punctuation">]</span>

<span class="token comment"># 是否接受扇区内包含订单</span>
<span class="token key property">enable_deals</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

<span class="token comment"># 对于 sealing 过程中的临时性异常，允许自动重试的次数</span>
<span class="token key property">max_retries</span> <span class="token punctuation">=</span> <span class="token number">3</span>

<span class="token comment"># 本地目录配置，按照实际情况配置，需初始化</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">store</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;path/to/local/store1&gt;&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">store</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;path/to/local/store2&gt;&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">store</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;path/to/local/store3&gt;&quot;</span>

<span class="token comment"># 各阶段并行任务数量配置</span>
<span class="token punctuation">[</span><span class="token table class-name">limit</span><span class="token punctuation">]</span>

<span class="token comment"># pc1 阶段的并发数量控制</span>
<span class="token comment"># 仅在一些特定的场景下进行配置，如计算资源少于按照存储资源所需的数量</span>
<span class="token comment"># pc1 = 1</span>

<span class="token key property">pc2</span> <span class="token punctuation">=</span> <span class="token number">1</span>
<span class="token key property">c2</span> <span class="token punctuation">=</span> <span class="token number">1</span>

<span class="token comment"># 持久化目录配置，按照实际情况配置，需初始化</span>
<span class="token punctuation">[</span><span class="token table class-name">remote</span><span class="token punctuation">]</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;path/to/remote/store&gt;&quot;</span>

<span class="token comment"># pc2 子进程处理器相关配置</span>
<span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span>

<span class="token comment"># 启动子进程处理器</span>
<span class="token key property">external</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

<span class="token comment"># [[processors.pc2.subs]]</span>
<span class="token comment"># [processors.pc2.subs.cgroup]</span>
<span class="token comment"># cpuset = &quot;24-27&quot;</span>

<span class="token comment"># [[processors.pc2.subs]]</span>
<span class="token comment"># [processors.pc2.subs.cgroup]</span>
<span class="token comment"># cpuset = &quot;28-31&quot;</span>

<span class="token comment"># c2 子进程处理器相关配置</span>
<span class="token punctuation">[</span><span class="token table class-name">processors.c2</span><span class="token punctuation">]</span>

<span class="token comment"># 启动子进程处理器</span>
<span class="token key property">external</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

<span class="token comment"># 子进程可使用的处理器核心,如果前面限核没有配置，则此处也不配置</span>
<span class="token comment"># [[processors.c2.subs]]</span>
<span class="token comment"># [processors.c2.subs.cgroup]</span>
<span class="token comment"># cpuset = &quot;32-47&quot;</span>
</code></pre></div><p>启动服务</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token assign-left variable">RUST_LOG</span><span class="token operator">=</span>debug <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>./ <span class="token function">nohup</span> ./venus-worker daemon --config<span class="token operator">=</span>./venus-worker.toml <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;</span> worker.log <span class="token operator">&amp;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/guide/Using-venus-cluster.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/11/17 上午11:28:12</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca3019b1.js" defer></script><script src="/assets/js/2.1f1c6e1f.js" defer></script><script src="/assets/js/99.3718c5fc.js" defer></script>
  </body>
</html>
