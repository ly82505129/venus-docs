(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{498:function(s,t,a){"use strict";a.r(t);var e=a(54),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"安装venus-market"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装venus-market"}},[s._v("#")]),s._v(" 安装venus-market")]),s._v(" "),a("p",[s._v("下载源代码。")]),s._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/filecoin-project/venus-market.git\n")])])]),a("p",[s._v("编译。")]),s._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deps\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("请使用f3c3eb27b05652b1ba5d463afdf3d78f67982a79或者更高commit号编译。")])]),s._v(" "),a("h2",{attrs:{id:"启动venus-market"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动venus-market"}},[s._v("#")]),s._v(" 启动venus-market")]),s._v(" "),a("p",[s._v("启动venus-market的provider端。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./venus-market run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--node-url /ip4/47.88.31.65/tcp/6666/ws "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--messager-url /ip4/47.88.31.65/tcp/39812/ws "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--auth-token eyJhbGciOiJIUzI1NiIsInCJ9.eyJuYW1lIjoieXotY2J9.oQmfNysESCAOI43Wo2kQ_6sY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--signer-url /ip4/10.10.11.43/tcp/5678/http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--signer-token eyJhbGciOiJIUzI1NiIsInCJ9.eyJBbGxvdyI6FkIiwidIl19.lM9FA462FONHN806SlKZw "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--piecestorage fs:/mnt/filestore "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--miner f019411 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" market.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意1")]),s._v(" "),a("p",[a("strong",[s._v("signer-url")]),s._v("和"),a("strong",[s._v("signer-token")]),s._v("都是指向venus-wallet，market的所有消息都是直接通过钱包签名，可以通过如下命令获取。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./venus-wallet auth api-info --perm sign\neyJhbGciOiJIUzI1NiIsInCJ9.eyJBbGxvdyI6FkIiwidIl19.lM9FA462FONHN806SlKZw:/ip4/0.0.0.0/tcp/5678/http\n")])])]),a("p",[s._v("默认venus-wallet只监控本机的5678端口，如果market和wallet不在一台机器上，可以修改如下信息后重启venus-wallet。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .venus_wallet/config.toml\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("API"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ListenAddress "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/ip4/0.0.0.0/tcp/5678/http"')]),s._v("\n")])])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意2")]),s._v(" "),a("p",[s._v("venus-market默认时间PublishMsgPeriod是1小时，测试时可以改的小一些来减少等待时间，修改配置文件后需重启venus-market。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .venusmarket/config.toml \nPublishMsgPeriod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10s"')]),s._v("\n\n$ ./venus-market run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" market.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])])]),s._v(" "),a("p",[s._v("设置监听地址。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./venus-market net listen\n/root/.venusmarket\n/ip4/10.10.8.16/tcp/58418/p2p/12D3KooWMk8nBpKXgRVBqkw45rc2pvRs9RhAZsFXFQGEqwuStMq\n/ip4/127.0.0.1/tcp/58418/p2p/12D3KooWMk8nBpKXgRVBqkw45rc2pvRs9RhAZsFXFQGEqwuStMq\n/ip6/::1/tcp/39379/p2p/12D3KooWMk8nBpKXgRVBqkw45rc2pvRs9RhAZsFXFQGEqwuStMq\n\n$ ./venus-market actor set-addrs /ip4/10.10.8.16/tcp/58418\n\n$ ./venus-market actor set-peer-id 12D3KooWMk8nBpKXgRVBqkw45rc2pvRs9RhAZsFXFQGEqwuStMq\n\n$ ./venus-market actor info\n/root/.venusmarket\npeers: 12D3KooWMk8nBpKXgRVBqkw45rc2pvRs9RhCAZsFXFQGEqwuStMq\naddr:\n\t /ip4/10.10.8.16/tcp/58418\n")])])]),a("p",[s._v("配置venus-sealer，使其能和market交互。")]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[s._v("$ cat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("venussealer/config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("toml\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("Market")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# venus-market的URL")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("Url")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/ip4/127.0.0.1/tcp/41235"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# venus-market的token")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("Token")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.e......"')]),s._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("通过"),a("code",[s._v("cat .venusmarket/token")]),s._v("获取market的token。")])]),s._v(" "),a("h2",{attrs:{id:"启动maket-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动maket-client"}},[s._v("#")]),s._v(" 启动maket-client")]),s._v(" "),a("p",[s._v("启动venus-market客户端程序"),a("code",[s._v("market-client")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./market-client run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--node-url /ip4/47.88.31.65/tcp/6666/ws "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--auth-token eyJhbGciOiJIUzI1NiIsInCJ9.eyJuYW1lIjoieXotY2J9.oQmfNysESCAOI43Wo2kQ_6sY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--messager-url /ip4/47.88.31.65/tcp/39812/ws "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--signer-url /ip4/10.10.11.43/tcp/5678/http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--signer-token eyJhbGciOiJIUzI1NiIsInCJ9.eyJBbGxvdyI6FkIiwidIl19.lM9FA462FONHN806SlKZw "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--addr t3v5shsytrnz7ycr7ou4yxq2nf2xm34idnvfgnom6wyru7lrmu2ykuvtte2hq6brk2v3qttrsysvssr42cxt6a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" client.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),a("h2",{attrs:{id:"发起存储订单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发起存储订单"}},[s._v("#")]),s._v(" 发起存储订单")]),s._v(" "),a("p",[s._v("导入任意一个文件。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./market-client "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n/root/.marketclient\nImport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1634298060645056875")]),s._v(", Root bafykbzacedj3oowcc22kt5qmpebil3szmes5c3l64ls2qtmx45ej43dvgylsw\n")])])]),a("p",[s._v("生成订单任务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./market-client deal\n\n/root/.marketclient\nData CID "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from lotus client "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入CID")]),s._v("\nbafykbzacedj3oowcc22kt5qmpebil3szmes5c3l64ls2qtmx45ej43dvgylsw\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" calculating data size\nPieceCid:  baga6ea4seaqpwx4dldvtojugowvm7ete4rgghsbwvbli37ovaqk7eg4pfrld6nq  PayLoadSize: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302017178")]),s._v(" PieceSize: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入订单日长")]),s._v("\nDeal duration "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("days"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("190")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入矿工号")]),s._v("\nMiner Addresses "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" f0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", none to find: f019411\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" querying miner asks\n\nProposing from f3v5shsytrnz7ycr7ou4yxq2nf2xm34idnvfgnom6wyru7lrmu2ykuvtte2hq6brk2v3qttrsysvssr42cxt6a\n        Balance: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12362.167968899390936035")]),s._v(" FIL\n\nPiece size: 512MiB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Payload size: 288MiB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: 4560h0m0s\nTotal price: ~0.0001368 FIL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00000000025")]),s._v(" FIL per epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nVerified: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否接受矿工的价格？")]),s._v("\nAccept "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes/no"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" executing\nDeal "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f019411"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CID: bafyreifbfpaayuwdd42pxgpql7fqo7bpjdccb7wscqn6tkix6qd5gni6xe\n")])])]),a("p",[s._v("此时需要稍等一会，大约6-10分钟，当状态变为StorageDealAwaitingPreCommit时，venus-sealer就可以下发订单的任务了。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./market-client list-deals\nDealCid    DealId   Provider   State   On Chain?    Slashed?   PieceCID  Size      Price     Duration   Verified\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".d5gni6xe "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33177")]),s._v(" f019411 StorageDealAwaitingPreCommit N N  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".pfrld6nq "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("508")]),s._v(" MiB "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00013739625")]),s._v(" FIL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("549585")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])])]),a("h3",{attrs:{id:"使用venus-sealer将订单任务下发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用venus-sealer将订单任务下发"}},[s._v("#")]),s._v(" 使用venus-sealer将订单任务下发")]),s._v(" "),a("p",[s._v("使用venus-sealer可以查询到这个订单的详细信息。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./venus-sealer deals list\nDealId  PieceCID  PieceSize  Client Provider StartEpoch  EndEpoch  Price Verified  Packed  FastRetrieval  Status\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33177")]),s._v(" baga6ea4seaqpwx4dldvtojugowvm7ete4rgghsbwvbli37ovaqk7eg4pfrld6nq  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v("  f3v5shsytrnz7ycr7ou4yxq2nf2xm34idnvfgnom6wyru7lrmu2ykuvtte2hq6brk2v3qttrsysvssr42cxt6a  f019411   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("375049")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("924634")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("250000000")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("           Undefine\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("venus-sealer等待订单的时间也可以修改为10s，方便测试。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .venussealer/config.toml\n  WaitDealsDelay "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10s"')]),s._v("\n")])])])]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("venus-sealer sectors deal")]),s._v("命令下发deal订单，然后使用./venus-sealer sectors list可以查看一个新的任务。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./venus-sealer sectors deal\n\n$ ./venus-sealer sectors list\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("454")]),s._v("  Packing  NO       NO      n/a                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 完成后状态变为")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("454")]),s._v("  Proving     YES      NO      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("957273")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" weeks "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" hours"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      116MiB\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);