(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{334:function(s,t,a){s.exports=a.p+"assets/img/venus-cluster.39d38e43.png"},496:function(s,t,a){"use strict";a.r(t);var e=a(54),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),e("p",[s._v("考虑到庞大的初始硬件和Filecoin质押"),e("a",{attrs:{href:"https://filscan.io/calculator",target:"_blank",rel:"noopener noreferrer"}},[s._v("投资"),e("OutboundLink")],1),s._v("以及相关的运营成本，开始Filecoin挖掘是一项艰巨的任务。 囊括了安全性、易用性和分布式存储池的想法，Venus将帮助存储提供者，正如社区所说，把"),e("a",{attrs:{href:"https://filecoinproject.slack.com/archives/CEGN061C5/p1610810730117900?thread_ts=1610809298.116800&cid=CEGN061C5",target:"_blank",rel:"noopener noreferrer"}},[s._v("全职工作"),e("OutboundLink")],1),s._v("变成为一个严肃的爱好。 希望本教程能让您立即开始挖矿！")]),s._v(" "),e("h2",{attrs:{id:"如何提供存储服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何提供存储服务"}},[s._v("#")]),s._v(" 如何提供存储服务")]),s._v(" "),e("p",[s._v("有两种方法可以开始使用Venus来提供存储服务。")]),s._v(" "),e("ol",[e("li",[s._v("部署最少的硬件并获得对第三方托管的共享venus模块的使用帐号。(本教程的其余部分将引导您完成这种部署Venus服务的方式)")]),s._v(" "),e("li",[s._v("自行部署所有需要的硬件和venus模块。(请参阅"),e("RouterLink",{attrs:{to:"/zh/guide/How-To-Deploy-MingPool.html"}},[s._v("这个")]),s._v("教程以了解更多信息)")],1)]),s._v(" "),e("p",[s._v("在遵循其余的教程和成功部署后，您可以开始封装扇区，增加算力并通过您对网络存储容量的贡献最终获得区块奖励！")]),s._v(" "),e("h2",{attrs:{id:"venus模块介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#venus模块介绍"}},[s._v("#")]),s._v(" venus模块介绍")]),s._v(" "),e("p",[s._v("根据其在挖矿集群中的作用，模块可以大致分为两类：共享和独立。 共享模块可以被认为是开始封装扇区所需的基础。 大多数与区块链的交互，如链同步、发送消息、赢得赢票等，都是由共享模块处理的。 这个想法是许多矿工都可以共用一组共享模块，从而减少维护成本。 独立模块处理封装和证明您的扇区。如果您选择使用第三方托管的共享Venus模块，您将花费大部分时间在独立模块上。 另请注意，"),e("code",[s._v("venus-wallet")]),s._v("模块可以作为共享或独立部署。")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("name")]),s._v(" "),e("th",[s._v("role")]),s._v(" "),e("th",[s._v("shared/independent")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("daemon for chain interactions")]),s._v(" "),e("td",[s._v("shared")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-miner",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-miner"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("block winning and proving")]),s._v(" "),e("td",[s._v("shared")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-messager",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-messager"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("chain message management")]),s._v(" "),e("td",[s._v("shared")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-auth",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-auth"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("utility for authorized use of shared modules")]),s._v(" "),e("td",[s._v("shared")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/ipfs-force-community/venus-gateway",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-gateway"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("utility for controlled access point of shared modules")]),s._v(" "),e("td",[s._v("shared")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-wallet",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-wallet"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("addresses/keys management")]),s._v(" "),e("td",[s._v("shared/independent")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-sealer",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-sealer"),e("OutboundLink")],1),s._v(", "),e("a",{attrs:{href:"https://github.com/filecoin-project/venus-sealer",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-worker"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("job scheduling, sealing and proving")]),s._v(" "),e("td",[s._v("independent")])]),s._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/filecoin-project/venus-market",target:"_blank",rel:"noopener noreferrer"}},[s._v("venus-market"),e("OutboundLink")],1)]),s._v(" "),e("td",[s._v("deal making")]),s._v(" "),e("td",[s._v("independent")])])])]),s._v(" "),e("h2",{attrs:{id:"服务架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务架构"}},[s._v("#")]),s._v(" 服务架构")]),s._v(" "),e("p",[s._v("下图展示了venus模块如何相互交互。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(334),alt:"venus-cluster"}})]),s._v(" "),e("h2",{attrs:{id:"硬件要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#硬件要求"}},[s._v("#")]),s._v(" 硬件要求")]),s._v(" "),e("p",[s._v("在"),e("a",{attrs:{href:"https://github.com/filecoin-project/community-china/discussions/18",target:"_blank",rel:"noopener noreferrer"}},[s._v("此处"),e("OutboundLink")],1),s._v("了解有关硬件要求的更多信息。或者参阅我们的"),e("a",{attrs:{href:"https://venus.filecoin.io/zh/operation/example-single-box.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("单机配置示例"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"前期准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[s._v("#")]),s._v(" 前期准备")]),s._v(" "),e("p",[s._v("在深入部署您的挖矿操作之前，请确保您已完成以下步骤。")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("建议您在部署到主网上之前在"),e("code",[s._v("calibration")]),s._v("网络中测试您的配置。")])]),s._v(" "),e("h3",{attrs:{id:"永久存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#永久存储"}},[s._v("#")]),s._v(" 永久存储")]),s._v(" "),e("p",[s._v("选择您熟悉的网络文件系统（例如 NFS）并部署您的存储集群。")]),s._v(" "),e("h3",{attrs:{id:"在共享模块中设置您的帐户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在共享模块中设置您的帐户"}},[s._v("#")]),s._v(" 在共享模块中设置您的帐户")]),s._v(" "),e("p",[s._v("有两种方法可以配置您的帐户。")]),s._v(" "),e("h4",{attrs:{id:"对于需接入共享模块的用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#对于需接入共享模块的用户"}},[s._v("#")]),s._v(" 对于需接入共享模块的用户")]),s._v(" "),e("p",[s._v("如果您尝试连接到第三方托管的共享venus模块，联系上述服务的管理员并让他们为您设置。")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("venus-wallet 可以部署为共享或独立模块，具体取决于您的安全要求。")])]),s._v(" "),e("h4",{attrs:{id:"对于共享模块的管理员"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#对于共享模块的管理员"}},[s._v("#")]),s._v(" 对于共享模块的管理员")]),s._v(" "),e("p",[s._v("如果您是托管共享 venus 模块的管理员，请使用以下命令注册各个集群。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果已有节点号")]),s._v("\n$ ./venus-auth user "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --miner "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("MINER_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有节点号，在创建节点号后更新")]),s._v("\n$ ./venus-auth user "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ ./venus-auth user update --name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --miner "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("MINER_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为此账号分配token，用于接入服务层验证")]),s._v("\n$ ./venus-auth token gen --perm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("AUTH_TOKEN_FOR_ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("h3",{attrs:{id:"软件依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#软件依赖"}},[s._v("#")]),s._v(" 软件依赖")]),s._v(" "),e("p",[s._v("在运行 venus 之前，您需要安装以下软件。")]),s._v(" "),e("h4",{attrs:{id:"构建工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建工具"}},[s._v("#")]),s._v(" 构建工具")]),s._v(" "),e("p",[s._v("Ubuntu/Debian:")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mesa-opencl-icd ocl-icd-opencl-dev gcc "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" bzr jq pkg-config "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" clang build-essential hwloc libhwloc-dev "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -y "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade -y\n")])])]),e("p",[s._v("CentOS:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" gcc bzr jq pkgconfig clang llvm mesa-libGL-devel opencl-headers ocl-icd ocl-icd-devel hwloc-devel\n")])])]),e("h3",{attrs:{id:"rust"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rust"}},[s._v("#")]),s._v(" Rust")]),s._v(" "),e("p",[s._v("安装"),e("a",{attrs:{href:"https://rustup.rs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("rustup"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --proto "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'=https'")]),s._v(" --tlsv1.2 -sSf https://sh.rustup.rs "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n")])])]),e("h4",{attrs:{id:"go"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#go"}},[s._v("#")]),s._v(" Go")]),s._v(" "),e("p",[s._v("构建venus，您需要安装"),e("a",{attrs:{href:"https://golang.org/dl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Go 1.16 或更高版本"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -c https://golang.org/dl/go1.16.2.linux-amd64.tar.gz -O - "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xz -C /usr/local\n")])])]),e("p",[s._v("将 "),e("code",[s._v("/usr/local/go/bin")]),s._v(" 添加到您的路径并设置"),e("code",[s._v("go env")]),s._v("。对于大多数Linux系统，您可以运行以下内容：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"export PATH='),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(':/usr/local/go/bin"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bashrc\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setup go env")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPROXY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://goproxy.cn\ngo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" -w "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GO111MODULE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n")])])]),e("p",[s._v("如果卡住，请参阅"),e("a",{attrs:{href:"https://golang.org/doc/install",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方Golang安装说明"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"安装venus-wallet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装venus-wallet"}},[s._v("#")]),s._v(" 安装venus-wallet")]),s._v(" "),e("p",[s._v("下载并编译"),e("code",[s._v("Venus-wallet")]),s._v("的源代码。")]),s._v(" "),e("ul",[e("li",[s._v("首次编译")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/filecoin-project/venus-wallet.git\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# change directory to venus-wallet")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" venus-wallet\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout -b incubation origin/incubation\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),e("ul",[e("li",[s._v("曾经成功编译过")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# change directory to venus-wallet,switch to the incubation branch")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n")])])]),e("p",[s._v("在后台运行"),e("code",[s._v("venus-wallet")]),s._v("模块。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-wallet run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" wallet.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("tail -f wallet.log")]),s._v(" 来监控钱包日志。")])]),s._v(" "),e("p",[s._v("为您的"),e("code",[s._v("venus-wallet")]),s._v("设置密码")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-wallet setpwd\nPassword:******\nEnter Password again:******\nPassword "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" successfully\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("请备份您的密码并妥善保存，否则你将无法使用wallet相关的功能。每次venus-wallet run启动时带--password标志会自动解锁钱包,如果没带,在wallet实例启动后你需要手动解锁:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-wallet unlock\nPassword: \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看解锁状态")]),s._v("\n$ ./venus-wallet lock-state\nwallet state: unlocked\n")])])]),e("p",[s._v("在扇区封装的过程中需要调用wallet进行签名,如果不解锁,会导致签名失败,进而导致扇区任务失败.")])]),s._v(" "),e("p",[s._v("生成owner和worker地址。（如果您没有现有的miner ID）")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-wallet new bls\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("OWNER_ADDRESS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ ./venus-wallet new bls\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("WORKER_ADDRESS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("如果您在"),e("code",[s._v("Calibration")]),s._v("上进行测试，则必须使用来自水龙头的测试币为您的所有地址提供资金。对于校准网，请使用此"),e("a",{attrs:{href:"https://faucet.calibration.fildev.network/funds.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("水龙头"),e("OutboundLink")],1),s._v("。")])]),s._v(" "),e("p",[e("em",[e("strong",[s._v("配置venus-wallet接入共享服务,使用您从共享模块管理员处获得的帐号信息更改 "),e("code",[s._v("~/.venus_wallet/config.toml")]),s._v("中的"),e("code",[s._v("[APIRegisterHub]")]),s._v(" 部分")])])]),s._v(" "),e("div",{staticClass:"language-toml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-toml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("APIRegisterHub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key property"}},[s._v("RegisterAPI")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/ip4/<IP_ADDRESS_OF_VENUS_GATEWAY>/tcp/45132"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key property"}},[s._v("Token")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<AUTH_TOKEN_FOR_ACCOUNT_NAME>"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key property"}},[s._v("SupportAccounts")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<ACCOUNT_NAME>"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("重新启动"),e("code",[s._v("venus-wallet")]),s._v("以使更改生效。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep [PID] of venus-wallet process")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" wallet\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kill the process and restart")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-wallet run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" wallet.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("如成功连接 "),e("code",[s._v("venus-gateway")]),s._v("，您将看到以下日志。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T15:14:12.457+0800    INFO    wallet_event    wallet_event/listenevent.go:197 connect to server fcf714b2-eeb6-498b-aafc-5e58eccd9d0f  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"api hub"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/ip4/<IP_ADDRESS>/tcp/45132"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("建议使用"),e("code",[s._v("systemd")]),s._v("或"),e("code",[s._v("supervisord")]),s._v("等线程控制。")])]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v('请确保venus-wallet 处于unlocked状态，要么会在Sealer模块初始化时卡在 "Waiting for confirmation"，导致miner帐号生成不了。')])]),s._v(" "),e("h2",{attrs:{id:"安装venus-sealer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装venus-sealer"}},[s._v("#")]),s._v(" 安装venus-sealer")]),s._v(" "),e("p",[s._v("下载并编译"),e("code",[s._v("venus-sealer")]),s._v("的源代码。")]),s._v(" "),e("ul",[e("li",[s._v("首次编译")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/filecoin-project/venus-sealer.git\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" venus-sealer\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout -b incubation origin/incubation\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# specify source compilation")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RUSTFLAGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-C target-cpu=native -g"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FFI_BUILD_FROM_SOURCE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deps\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),e("p",[s._v("源码编译也可以")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RUSTFLAGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-C target-cpu=native -g"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FFI_BUILD_FROM_SOURCE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deps\n")])])]),e("ul",[e("li",[s._v("曾经成功编译过")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Update and compile filecoin-ffi, if filecoin-ffi has not changed, no need to execute")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" submodule update --init --recursive\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" clean\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deps\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("ul",[e("li",[s._v("确保编译时使用"),e("code",[s._v('RUSTFLAGS="-C target-cpu=native -g" FFI_BUILD_FROM_SOURCE="1"')]),s._v(" 源码编译filecoin-ffi库，如果cpu支持则启用SHA扩展，这会大幅提高扇区封装速度，源码编译（make deps）时特征如下：")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("+ trap '{ rm -f $__build_output_log_tmp; }' EXIT\n+ local '__rust_flags=--print native-static-libs -C target-feature=+sse2'\n+ RUSTFLAGS='--print native-static-libs -C target-feature=+sse2'\n+ cargo +nightly-2021-04-24 build --release --no-default-features --features multicore-sdr --features pairing,gpu\n+ tee /tmp/tmp.IYtnd3xka9\n   Compiling autocfg v1.0.1\n   Compiling libc v0.2.97\n   Compiling cfg-if v1.0.0\n   Compiling proc-macro2 v1.0.27\n   Compiling unicode-xid v0.2.2\n   Compiling syn v1.0.73\n   Compiling lazy_static v1.4.0\n   Compiling cc v1.0.68\n   Compiling typenum v1.13.0\n   Compiling serde_derive v1.0.126\n   Compiling serde v1.0.126\n")])])])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("如果您是第一次运行sealer，它会开始下载证明参数，这可能需要相当长的时间。如果您确认已下载"),e("code",[s._v("proof params")]),s._v("，可使用"),e("code",[s._v("TRUST_PARAMS=1")]),s._v("跳过下载逻辑执行。如果您位于中国，请按照提示"),e("RouterLink",{attrs:{to:"/zh/advanced/Tips-Running-In-China.html"}},[s._v("此处")]),s._v("加快流程。")],1)]),s._v(" "),e("h3",{attrs:{id:"创建新的miner-id来初始化sealer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建新的miner-id来初始化sealer"}},[s._v("#")]),s._v(" 创建新的miner-id来初始化sealer")]),s._v(" "),e("p",[s._v("如果您还没有miner-id，请运行以下命令来初始化sealer。请确保"),e("code",[s._v("<OWNER_ADDRESS>")]),s._v("中有足够资金支付gasfee，否则"),e("code",[s._v("init")]),s._v("将失败。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-sealer "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Leave out this flag for mainnet")]),s._v("\n--network"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("calibration init "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--worker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("WORKER_ADDRESS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--owner"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("OWNER_ADDRESS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Choose between 32G or 64G for mainnet")]),s._v("\n--sector-size 512M "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Config for different shared venus modules")]),s._v("\n--node-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/3453 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--messager-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS_MESSAGER"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PORT_OF_VENUS_MESSAGER"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--gateway-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS_GATEWAY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PORT_OF_VENUS_GATEWAY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--auth-token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("AUTH_TOKEN_FOR_ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Flags sealer to not storing any sealed sectors on the machine it runs on")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You can leave out this flag if you are on testnet")]),s._v("\n--no-local-storage "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sealer.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("以下为成功创建"),e("code",[s._v("<MINER_ID>")]),s._v("的日志。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:02:07.199+0800\tINFO\tmain\tvenus-sealer/init.go:142\tInitializing venus sealer\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:02:07.199+0800\tINFO\tmain\tvenus-sealer/init.go:162\tChecking proof parameters\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:35.229+0800\tINFO\tparamfetch\tgo-paramfetch@v0.0.2-0.20210614165157-25a6c7769498/paramfetch.go:207\tparameter and key-fetching complete\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:35.229+0800\tINFO\tmain\tvenus-sealer/init.go:176\tTrying to connect to full node RPC\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:35.592+0800\tINFO\tmain\tvenus-sealer/init.go:190\tChecking full node "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" status\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:35.592+0800\tINFO\tmain\tvenus-sealer/init.go:198\tChecking "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" repo exists\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:35.592+0800\tINFO\tmain\tvenus-sealer/init.go:210\tChecking full node version\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:36.099+0800\tINFO\tmain\tvenus-sealer/init.go:226\tInitializing repo\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:36.100+0800\tINFO\tmain\tvenus-sealer/init.go:339\tInitializing libp2p identity\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:39.022+0800\tINFO\tmain\tvenus-sealer/init.go:515\tPushed CreateMiner message: 3bfd3fc8-4f8d-45c8-86e9-5fe29a02fec0\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:03:39.022+0800\tINFO\tmain\tvenus-sealer/init.go:516\tWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" confirmation\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:07:39.184+0800\tINFO\tmain\tvenus-sealer/init.go:532\tNew miners address is: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("MINER_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t2qgsnl5qy7sehm7u5nobkblmi2t4tuvh7flc4nqy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:07:39.184+0800\tINFO\tmain\tvenus-sealer/init.go:411\tCreated new miner: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("MINER_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-12T17:07:39.185+0800\tINFO\tmain\tvenus-sealer/init.go:295\tSealer successfully created, you can now start it with "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'venus-sealer run'")]),s._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[e("code",[s._v("init")]),s._v("命令会发送创建矿工消息并等待上链，可能需要等待几分钟。")])]),s._v(" "),e("h3",{attrs:{id:"使用现有的miner-id初始化sealer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用现有的miner-id初始化sealer"}},[s._v("#")]),s._v(" 使用现有的miner-id初始化sealer")]),s._v(" "),e("p",[s._v("如果您已经有miner-id，请运行以下命令来初始化sealer。请确保"),e("code",[s._v("<OWNER_ADDRESS>")]),s._v("中有足够资金支付gasfee，否则"),e("code",[s._v("init")]),s._v("将失败。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Leave out this flag for mainnet")]),s._v("\n--network"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("calibration init "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--actor"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("MINER_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Config for different shared venus modules")]),s._v("\n--node-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/3453 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--messager-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS_MESSAGER"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PORT_OF_VENUS_MESSAGER"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--gateway-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP_ADDRESS_OF_VENUS_GATEWAY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PORT_OF_VENUS_GATEWAY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--auth-token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("AUTH_TOKEN_FOR_ACCOUNT_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Flags sealer to not store any sealed sectors on the machine it runs on")]),s._v("\n--no-local-storage "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sealer.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("以下为成功init日志的范例。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.170+0800    INFO    main    venus-sealer/init.go:193        Checking "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" repo exists\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.170+0800    INFO    main    venus-sealer/init.go:205        Checking full node version\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.174+0800    INFO    main    venus-sealer/init.go:221        Initializing repo\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.175+0800    INFO    main    venus-sealer/init.go:334        Initializing libp2p identity\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.181+0800    INFO    main    venus-sealer/init.go:406        Created new miner: t02105\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-07T04:15:49.181+0800    INFO    main    venus-sealer/init.go:290        Sealer successfully created, you can now start it with "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'venus-sealer run'")]),s._v("\n")])])]),e("h2",{attrs:{id:"开始封装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始封装"}},[s._v("#")]),s._v(" 开始封装")]),s._v(" "),e("p",[s._v("运行sealer。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-sealer run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sealer.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("给sealer指定临时路径（存放p1-c2阶段生成文件，sector完成后会释放）和持久存储路径（用于做winningPoSt或wdPoSt的文件需要持久保存）")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer storage attach --init --store "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ABSOLUTE_PATH_OF_YOUR_PERMANENT_STORAGE"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ ./venus-sealer storage attach --init --seal "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ABSOLUTE_PATH_OF_YOUR_SEALING_STORAGE"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("p",[s._v("如果你的两个目录是相同的，那么可以一次性指定")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./venus-sealer storage attach --init --store --seal <ABSOLUTE_PATH>\n")])])]),e("blockquote",[e("p",[e("code",[s._v("--groups / --allow-to")]),s._v(" 用于将worker分组，介绍见后文。")])]),s._v(" "),e("blockquote",[e("p",[s._v("如果你打算只用venus-sealer封装扇区，那么seal和store路径必须都配置，缺一不可。")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer storage list\n37109bd3-15cc-4821-99e8-b7af891f2e84:\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####################***                           ] 4.82 TiB/10.39 TiB 46%")]),s._v("\n        Unsealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Sealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Caches: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Reserved: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("483.2")]),s._v(" GiB\n        Weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Use: Seal \n        URL: http://127.0.0.1:3456/remote "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("latency: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".1ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nf4074188-c851-4468-820b-e138beb5f12d:\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####################                              ] 4.348 TiB/10.39 TiB 41%")]),s._v("\n        Unsealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Sealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Caches: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Reserved: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n        Weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Use: Seal Store\n        Local: /mnt/mount/litao/\n        URL: http://192.168.200.17:2345/remote\n")])])]),e("p",[s._v("封装一个扇区。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer sectors pledge \n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("如果遇到如下错误, 请复制一个已经生成的unsealed文件("),e("code",[s._v("~/.venussealer/unsealed/")]),s._v(") 到 "),e("code",[s._v("/var/tmp/s-basic-unsealed-34359738368")]),s._v(".")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-09-01T10:41:10.394+0200    WARN    sectors storage-sealing/fsm.go:626      sector "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("611")]),s._v(" got error event sealing.SectorSealPreCommit1Failed: seal pre commit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" failed: storage call error "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": The default unsealed does not exist,please copy a generated unsealed "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to /var/tmp/s-basic-unsealed-34359738368\n")])])]),e("p",[s._v("我们建议先生成一个unsealed文件后拷贝到每个做 P1 任务的worker机器/var/tmp目录,文件的命令规则:")]),s._v(" "),e("ul",[e("li",[s._v("s-basic-unsealed-"),e("em",[e("strong",[s._v("SectorSize")])])]),s._v(" "),e("li",[s._v("s-piece-infos-"),e("em",[e("strong",[s._v("SectorSize")])])])]),s._v(" "),e("p",[s._v("SectorSize 选项: 2048,8388608,536870912,34359738368,68719476736,eg. 32G:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/var/tmp/s-piece-infos-34359738368\n/var/tmp/s-basic-unsealed-34359738368\n")])])]),e("p",[s._v("不同SectorSize对应的s-piece-infos-***SectorSize***文件内容:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 32G\n[{"Size":34359738368,"PieceCID":{"/":"baga6ea4seaqao7s73y24kcutaosvacpdjgfe5pw76ooefnyqw4ynr3d2y6x2mpq"}}]\n\n# 8M\n[{"Size":8388608,"PieceCID":{"/":"baga6ea4seaqgl4u6lwmnerwdrm4iz7ag3mpwwaqtapc2fciabpooqmvjypweeha"}}]\n\n# 512M\n[{"Size":536870912,"PieceCID":{"/":"baga6ea4seaqdsvqopmj2soyhujb72jza76t4wpq5fzifvm3ctz47iyytkewnubq"}}]\n\n# 2k\n[{"Size":2048,"PieceCID":{"/":"baga6ea4seaqpy7usqklokfx2vxuynmupslkeutzexe2uqurdg5vhtebhxqmpqmy"}}]\n\n# 64G\n[{"Size":68719476736,"PieceCID":{"/":"baga6ea4seaqomqafu276g53zko4k23xzh4h4uecjwicbmvhsuqi7o4bhthhm4aq"}}]\n')])])])]),s._v(" "),e("p",[s._v("一般启动一个脚本或系统事务用于发任务,最好是相隔一段时间发一个任务。为了避免任务数过多导致系统卡顿，需要控制sector的任务上限(MaxSealingSectors)。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ~/.venussealer/config.toml \n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Sealing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  MaxSealingSectors "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),e("p",[s._v("检查正在进行的封装工作")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer sealing\n$ ./venus-sealer sealing workers\n$ ./venus-sealer sealing "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),s._v("\n")])])]),e("p",[s._v("检查扇区状态")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer sectors list\n$ ./venus-sealer sectors status  --log  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sectorNum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("p",[s._v("如果某个扇区因为ticket过期或别的原因无法继续做下去，你需要及时remove掉，不然会占着磁盘和任务数。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Terminating -> TerminateWait -> TerminateFinality/TerminateFailed")]),s._v("\n$ ./venus-sealer sectors terminate  --really-do-it "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sectorNum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Removing -> RemoveFailed/Removed")]),s._v("\n$ ./venus-sealer sectors remove  --really-do-it "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sectorNum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("p",[s._v("Remove和Terminate执行受限于Sealing的并发机制，有时需要很长时间，你可以尝试多次执行这两个命令加快速度。查看Sector状态：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-sealer sectors list\nID  State       OnChain  Active  Expiration                    Deals\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   Proving     YES      YES     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2513094")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" year "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" weeks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  CC\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   Removed    NO       NO      n/a                           CC\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   PreCommit1  NO       NO      n/a                           CC\n")])])]),e("p",[s._v("设置发送消息的地址：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Addresses"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PreCommitControl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# P2")]),s._v("\n  CommitControl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# C2")]),s._v("\n  DisableOwnerFallback "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# true 表示禁用")]),s._v("\n  DisableWorkerFallback "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# true 表示禁用")]),s._v("\n")])])]),e("blockquote",[e("p",[s._v("P2,C2消息的from可以设置多个，但必须是miner-id相关联的，如worker，owner或controller。")])]),s._v(" "),e("h2",{attrs:{id:"worker机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#worker机制"}},[s._v("#")]),s._v(" worker机制")]),s._v(" "),e("p",[s._v("在Filecoin系统中,venus-sealer可以被认为是一个带有状态管理机的venus-worker，也就是说:")]),s._v(" "),e("p",[s._v("sealer = worker + sector_state_manager")]),s._v(" "),e("p",[s._v("除了做worker具备的工作外，它有两个主要功能:")]),s._v(" "),e("ul",[e("li",[s._v("管理每个扇区的状态，包括分配扇区任务，处理与扇区状态变化的事件等;")]),s._v(" "),e("li",[s._v("定期执行windowPost.")])]),s._v(" "),e("p",[s._v("因此，我们通常将耗时的任务交给venus-worker做，让sealer做windowPoSt和Sectors状态管理。这样做的好处是:venus-sealer重启后，不会影响到worker正在进行的任务,否则会导致仍无频繁重做.")]),s._v(" "),e("ul",[e("li",[s._v("只允许venus-sealer做AddPiece，禁止做P1, P2, C1, C2等任务，修改` ~/.venussealer/config.toml ', 然后重启.")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("  ~/.venussealer/config.toml \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modify")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Storage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ParallelFetchLimit "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  AllowAddPiece "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  AllowPreCommit1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  AllowPreCommit2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  AllowCommit "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  AllowUnseal "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Restart venus-sealer after saving")]),s._v("\n")])])]),e("p",[s._v("-- 启动worker并指定可以接的任务类型.")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ TRUST_PARAMS=1 nohup ./venus-worker run \\\n--miner-addr=</ip4/sealer-ip/tcp/sealer-port> \\\n--miner-token=<token> \\\n--task-total=100 \\\n--listen=<0.0.0.0:3458> <flags> > worker.log 2>&1 &           \n")])])]),e("ul",[e("li",[s._v("sealer-port: cat ~/.venussealer/api, eg. /ip4/0.0.0.0/tcp/2345/http,把0.0.0.0替换为venus-sealer实际的IP地址.")]),s._v(" "),e("li",[s._v("token: cat ~/.venussealer/token")]),s._v(" "),e("li",[s._v("flags:")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("--addpiece                    enable addpiece (default: true)\n--precommit1                  enable precommit1 (32G sectors: 1 core, 128GiB RAM) (default: true)\n--unseal                      enable unsealing (32G sectors: 1 core, 128GiB RAM) (default: true)\n--precommit2                  enable precommit2 (32G sectors: multiple cores, 96GiB RAM) (default: true)\n--commit                      enable commit (32G sectors: multiple cores or GPUs, 128GiB RAM + 64GiB swap) (default: true)\n--task-total                  total number of task (default: 100)\n")])])]),e("ul",[e("li",[e("em",[e("strong",[s._v("task-total为可同时进行的任务数,默认100;")])])])]),s._v(" "),e("p",[s._v("一般情况下，我们只为venus-worker配置seal路径,Store继承venus-sealer。worker完成扇区密封时，永久存储文件将被转移到venus-sealer指定的store路径.")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-worker storage attach --init --seal "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ABSOLUTE_LOCAL_PATH"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("blockquote",[e("p",[e("code",[s._v("--groups / --allow-to")]),s._v(" 用于将worker分组，介绍见后文。")])]),s._v(" "),e("h3",{attrs:{id:"多worker注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#多worker注意事项"}},[s._v("#")]),s._v(" 多worker注意事项")]),s._v(" "),e("ul",[e("li",[s._v("TMPDIR指定worker的临时目录，比如gpu的文件锁就会生成在此路径下，worker运行在同一机器上时需要指定不同的TMPDIR，否则会竞争文件锁；")]),s._v(" "),e("li",[s._v("多个worker在同一机器同用户创建时需要指定不同的库目录，需要带repo flag，形式：")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TRUST_PARAMS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-worker --repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("REPO_PATH"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" run "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--miner-addr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/ip4/sealer-ip/tcp/sealer-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --miner-token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--listen"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:345"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("flags"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" worker.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("查看venus-worker状态")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ ./venus-worker info\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A worker's storage will be added to the venus-sealer storage list")]),s._v("\n$ ./venus-sealer storage list \n01135ade-337a-4011-9cd8-6e85edbe08fc:\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######                                           ] 26.52 TiB/181.2 TiB 14%")]),s._v("\n        Unsealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Sealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1080")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Caches: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1080")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Reserved: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n        Weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Use: Seal Store\n        Local: /storage-nfs/torage\n        URL: http://0.0.0.0:2345/remote\n14142f91-6365-4b2a-ad1b-d2dd4ebd6e33:\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###################                               ] 4.044 TiB/10.39 TiB 38%")]),s._v("\n        Unsealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Sealed: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Caches: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Reserved: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n        Weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Use: Seal \n        URL: http://192.168.200.17:3458/remote "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("latency: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),e("h3",{attrs:{id:"存储分组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#存储分组"}},[s._v("#")]),s._v(" 存储分组")]),s._v(" "),e("p",[e("code",[s._v("--groups / --allow-to")]),s._v(" 用于 "),e("code",[s._v("venus-sealer/venus-worker storage attach")]),s._v(" 命令，允许创建工作组，并避免在多venus-worker之间不必要地移动数据。例如在以下设置中：")]),s._v(" "),e("ul",[e("li",[s._v("venus-sealer\n"),e("ul",[e("li",[s._v('Groups：["example-storage-group-1"]')])])]),s._v(" "),e("li",[s._v("venus-worker 1（PC1、PC2）：\n"),e("ul",[e("li",[s._v('Groups：["example-seal-group-1"]，AllowTo: ["example-seal-group-1"]')])])]),s._v(" "),e("li",[s._v("venus-worker 2（PC1、PC2）：\n"),e("ul",[e("li",[s._v("Groups：[“example-seal-group-2”]，AllowTo：[“example-seal-group-2”]")])])]),s._v(" "),e("li",[s._v("venus-worker 3 (PC1)：\n"),e("ul",[e("li",[s._v('AllowTo：["example-seal-group-1"]')])])])]),s._v(" "),e("p",[s._v("如果没有存储组，worker 1/2 上的 PC2 任务可以使用来自其他 worker 的扇区数据进行调度，这通常会浪费带宽，并且偶尔会在获取数据时阻塞处理。")]),s._v(" "),e("p",[s._v("使用如上配置的存储组，在 worker1/worker2 上完成 PC1 的扇区将始终在同一个 worker 上执行 PC2。来自 worker3 的扇区将只转到 worker1 以获取 PC2。")]),s._v(" "),e("p",[s._v("可以通过两种方式设置组：")]),s._v(" "),e("ul",[e("li",[s._v("对于现在的存储路径，当使用带有新 "),e("code",[s._v("--groups / --allow-to")]),s._v(" 标志的 "),e("code",[s._v("storage attach --init")]),s._v(" 命令时。")]),s._v(" "),e("li",[s._v("对于现有的存储路径 - 通过修改 [path]/sectorstore.json，然后重新启动 venus-miner/venus-worker。")])]),s._v(" "),e("p",[s._v("Groups:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "ID": "74e1d667-7bc9-49bc-a9a6-0c30afd8684c",\n  "Weight": 10,\n  "CanSeal": false,\n  "CanStore": true,\n  "MaxStorage": 0,\n  "Groups": ["storage0"]\n}\n')])])]),e("p",[s._v("AllowTo:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "ID": "54f090bf-9fa9-4a47-9f67-0cc4f24c810e",\n  "Weight": 10,\n  "CanSeal": true,\n  "CanStore": false,\n  "AllowTo": ["storage0"]\n}\n')])])]),e("ul",[e("li",[s._v("如何让同一台机器的worker（PC2）只接收本机PC1完成的扇区任务？\n所有worker的"),e("code",[s._v("storage attach")]),s._v("时设置相同的 "),e("code",[s._v("--groups")]),s._v(" 和"),e("code",[s._v("--allow-to")]),s._v("，并指定相同的 "),e("code",[s._v("seal")]),s._v(" 目录 。")])]),s._v(" "),e("h2",{attrs:{id:"加速项配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加速项配置"}},[s._v("#")]),s._v(" 加速项配置")]),s._v(" "),e("p",[s._v("如果您的系统硬件资源足够大，或者拥有GPU等可以加快扇区密封的资源,您可以根据实际环境设置环境变量。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MINER_API_INFO as obtained before")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMPDIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/fast/disk/folder3                    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# used when sealing")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" MINER_API_INFO:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("TOKEN"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/ip4/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("miner_api_address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tcp/"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/http`\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BELLMAN_CPU_UTILIZATION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.875")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# optimal value depends on exact hardware")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_MAXIMIZE_CACHING")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_USE_GPU_COLUMN_BUILDER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# when GPU is available")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_USE_GPU_TREE_BUILDER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# when GPU is available")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_PARAMETER_CACHE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/fast/disk/folder "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > 100GiB!")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_PARENT_CACHE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/fast/disk/folder2   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > 50GiB!")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The following increases speed of PreCommit1 at the cost of using a full")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU core-complex rather than a single core.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://github.com/filecoin-project/rust-fil-proofs/ and the")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "Worker co-location" section below.')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_USE_MULTICORE_SDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),e("p",[s._v("venus-worker使用了一个GPU程序，在双卡3080机器上运行，程序会自动搜寻并使用0号和1号GPU卡。性能测试要求程序只运行在一张GPU卡上，但程序没有参数设置GPU的地方。\n采取CUDA环境变量CUDA_VISIBLE_DEVICES来限定程序运行的GPU设备解决问题:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("// CUDA_VISIBLE_DEVICES设置说明，设置device对程序可见\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VISIBLE_DEVICES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       // 仅使用device1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("即卡一"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VISIBLE_DEVICES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,1")]),s._v("     // 仅使用device "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("和 device1\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VISIBLE_DEVICES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0,1"')]),s._v("\t // 同上, 仅使用device "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("和 device1\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VISIBLE_DEVICES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,2")]),s._v(",3   // 仅使用device "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", device2和device3\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VISIBLE_DEVICES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2,0")]),s._v(",3   // 仅使用device0, device2和device3\n")])])]),e("p",[s._v("可以通过以下变量来提升显卡GPU内存的使用率，减少P2任务的用时\nFIL_PROOFS_MAX_GPU_COLUMN_BATCH_SIZE  -  每次计算Column的batch大小，默认400000;\nFIL_PROOFS_MAX_GPU_TREE_BATCH_SIZE  -   每次Encoding计算的batch大小，默认700000")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("// 建议值\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_MAX_GPU_COLUMN_BATCH_SIZE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000000")]),s._v(",FIL_PROOFS_MAX_GPU_TREE_BATCH_SIZE"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000000")]),s._v("\n")])])]),e("p",[s._v("这些变量的使用有两种方式：")]),s._v(" "),e("ul",[e("li",[s._v("在启动venus-sealer和venus-worker前 export设置,如我想开启cpu多核计算")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_USE_MULTICORE_SDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-sealer run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" sealer.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("ul",[e("li",[s._v("在启动命令中使用环境变量")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIL_PROOFS_USE_MULTICORE_SDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./venus-worker run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" worker.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[e("em",[e("strong",[s._v("关于GPU的使用")])])]),s._v(" "),e("ul",[e("li",[s._v("C2阶段会主动搜索机器是否有可用GPU，有则使用；")]),s._v(" "),e("li",[s._v("P2阶段在生成tree-c和tree-r-last阶段可以使用gpu加速，但需要在启动对应sealer或worker时配置环境变量：FIL_PROOFS_USE_GPU_COLUMN_BUILDER=1表示生成tree-r-last阶段使用GPU，FIL_PROOFS_USE_GPU_TREE_BUILDER=1表示生成tree-c阶段使用GPU。")])]),s._v(" "),e("p",[s._v("参考文档")]),s._v(" "),e("ul",[e("li",[s._v("https://docs.filecoin.io/mine/lotus/miner-troubleshooting/")]),s._v(" "),e("li",[s._v("https://docs.filecoin.io/get-started/lotus/installation/#linux")]),s._v(" "),e("li",[s._v("https://docs.filecoin.io/mine/lotus/miner-setup/#pre-requisites")]),s._v(" "),e("li",[s._v("https://github.com/filecoin-project/venus-docs/blob/master/docs/zh/mine/venus/power_growth_and_maintain.md")])]),s._v(" "),e("h2",{attrs:{id:"lotus-miner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lotus-miner"}},[s._v("#")]),s._v(" lotus-miner")]),s._v(" "),e("p",[s._v("   如果你已经用lotus-miner密封了一定数量的扇区，我们建议你继续使用lotus-miner，venus社区同步维护可接入共享组件的lotus-miner：https://github.com/ipfs-force-community/lotus，对于lotus官方的每个大版本，我们会同步发布对应版本。")]),s._v(" "),e("p",[s._v("   这个分支只是将对接共享组件的逻辑加进来，其他逻辑一切没变，你可以按照原有的习惯去执行lotus-miner。")]),s._v(" "),e("h3",{attrs:{id:"已有算力集群处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#已有算力集群处理"}},[s._v("#")]),s._v(" 已有算力集群处理")]),s._v(" "),e("p",[s._v("  等待lotus-miner正在做的扇区完成后执行下列流程：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("停止lotus-miner，因为默认lotus-miner和venus-sealer都是用的2345端口；")])]),s._v(" "),e("li",[e("p",[s._v("初始化venus-sealer，--actor 指定原来的矿工地址；")])]),s._v(" "),e("li",[e("p",[s._v("启动venus-sealer后，使用venus-sealer storage attach --store 来指定原来数据存储的路径；")])]),s._v(" "),e("li",[e("p",[s._v("修改默认下发sector id的数值,导入lotus-miner下发的扇区：")])])]),s._v(" "),e("p",[s._v("   如果想继续增长算力,需要修改扇区nextid的值>已完成扇区的最大ID;想在venus-sealer查看已有的扇区,需要从lotus-miner导入,具体方法如下:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./lotus-convert -lotus-miner-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.lotusminer/ -venus-sealer-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.venussealer -taskType"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -sid"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),e("p",[e("code",[s._v("taskType")]),s._v(": 0-只修改nextid,1-只导入扇区,2-都做; "),e("code",[s._v("sid")]),s._v(": 默认是0,这时会从源仓库中查找最大扇区的ID写入nextid,其他值-以指定的值修改nextid,举例如下:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只修改nextid=300")]),s._v("\n./lotus-convert -lotus-miner-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.lotusminer/ -venus-sealer-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.venussealer -taskType"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -sid"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅导入扇区")]),s._v("\n./lotus-convert -lotus-miner-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.lotusminer/ -venus-sealer-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.venussealer -taskType"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入扇区并修改nextid为已有扇区最大的ID")]),s._v("\n./lotus-convert -lotus-miner-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.lotusminer/ -venus-sealer-repo"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.venussealer -taskType"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),e("h2",{attrs:{id:"问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题?")]),s._v(" "),e("p",[s._v("来"),e("a",{attrs:{href:"https://filecoinproject.slack.com/archives/CEHHJNJS3",target:"_blank",rel:"noopener noreferrer"}},[s._v("Slack"),e("OutboundLink")],1),s._v("上找我们吧！")])])}),[],!1,null,null,null);t.default=r.exports}}]);