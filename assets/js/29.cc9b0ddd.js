(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{414:function(e,t,s){"use strict";s.r(t);var a=s(54),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"overview"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),s("p",[e._v("If you already have power sealed using "),s("code",[e._v("lotus-miner")]),e._v(", you can use venus-ready "),s("code",[e._v("lotus-miner")]),e._v(" maintained in this "),s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus",target:"_blank",rel:"noopener noreferrer"}},[e._v("repo"),s("OutboundLink")],1),e._v(". venus-ready "),s("code",[e._v("lotus-miner")]),e._v(" retains current lotus logic while adding components that allow connection to chain services (venus shared modules). venus-ready "),s("code",[e._v("lotus-miner")]),e._v(" will be released for every major network updates.")]),e._v(" "),s("h3",{attrs:{id:"branches"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#branches"}},[e._v("#")]),e._v(" Branches")]),e._v(" "),s("p",[e._v("List of lotus version(s) to their corresponding venus-ready branch. Note that one way to find corresponding branch is to follow this branch naming convention: ${lotus_latestVersion}/incubation. For example, "),s("code",[e._v("v1.12.0/incubation")]),e._v(".")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("lotus ver.")]),e._v(" "),s("th",[e._v("venus-ready branch")]),e._v(" "),s("th",[e._v("venus-ready commit")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("1.12.0")]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/tree/v1.12.0/incubation",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.12.0/incubation"),s("OutboundLink")],1)]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/de080945d2d9d4d42317ef232ecfbce0a4b61104",target:"_blank",rel:"noopener noreferrer"}},[e._v("de080945d2d9d4d42317ef232ecfbce0a4b61104"),s("OutboundLink")],1)])]),e._v(" "),s("tr",[s("td",[e._v("1.10.1")]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commits/v1.10.1_incubation",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.10.1_incubation"),s("OutboundLink")],1)]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/4996c6e3f70b958bae8540d822c367c3aa3546ad",target:"_blank",rel:"noopener noreferrer"}},[e._v("4996c6e3f70b958bae8540d822c367c3aa3546ad"),s("OutboundLink")],1)])]),e._v(" "),s("tr",[s("td",[e._v("1.11.0")]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commits/v1.11.0_incubation",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.11.0_incubation"),s("OutboundLink")],1)]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/a500491902058a4e6e59283cd56755d56701e4b1",target:"_blank",rel:"noopener noreferrer"}},[e._v("a500491902058a4e6e59283cd56755d56701e4b1"),s("OutboundLink")],1)])])])]),e._v(" "),s("h2",{attrs:{id:"code-walk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#code-walk"}},[e._v("#")]),e._v(" Code walk")]),e._v(" "),s("p",[e._v("The following outlines some of the key changes to the code.")]),e._v(" "),s("h3",{attrs:{id:"configuration-change"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-change"}},[e._v("#")]),e._v(" Configuration Change")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[Venus]\n  [Venus.Messager]\n    Url = ""\n    Token = ""\n  [Venus.RegisterProofAPI]\n    Url = ""\n    Token = ""\n  [Venus.Wallet]\n    Url = ""\n    Token = ""\n')])])]),s("h3",{attrs:{id:"message-apis-for-lotus-miner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#message-apis-for-lotus-miner"}},[e._v("#")]),e._v(" Message APIs for lotus-miner")]),e._v(" "),s("p",[e._v("Among the commands provided by lotus-miner, the commands that need to send, wait, and search for messages are all realized by calling the newly added messenger interface of lotus-miner.")]),e._v(" "),s("ol",[s("li",[e._v("MessagerWaitMessage")]),e._v(" "),s("li",[e._v("MessagerPushMessage")]),e._v(" "),s("li",[e._v("MessagerGetMessage")])]),e._v(" "),s("p",[e._v("File path(s)：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("cmd/lotus-storage-miner/*\napi/api_storage.go\nextern/storage-sealing/sealing.go\nextern/storage-sealing/terminate_batch.go\nnode/modules/storageminer.go\nstorage/*\n")])])]),s("h3",{attrs:{id:"add-gasoverestimate-params-to-messagesendspec"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add-gasoverestimate-params-to-messagesendspec"}},[e._v("#")]),e._v(" Add GasOverEstimate params to MessageSendSpec")]),e._v(" "),s("p",[e._v("File path(s)：api/types.go")]),e._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" MessageSendSpec "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tMaxFee            abi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("TokenAmount\n\tGasOverEstimation "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("float64")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h3",{attrs:{id:"check-if-address-exists-before-sending-messages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#check-if-address-exists-before-sending-messages"}},[e._v("#")]),e._v(" Check if address exists before sending messages")]),e._v(" "),s("p",[e._v("In lotus-miner, the API that was used to determine the existence of the address needs to be changed to the WalletHas API that calls the messenger.")]),e._v(" "),s("p",[e._v("File path(s): "),s("code",[e._v("storage/addresses.go")])]),e._v(" "),s("h3",{attrs:{id:"venus-messager-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager-client"}},[e._v("#")]),e._v(" venus-messager client")]),e._v(" "),s("p",[e._v("The venus-messager client is similar to lotus, both of which use jsonrpc. You can use lotus' jsonrpc library for access. Note that the namespace is Message.")]),e._v(" "),s("p",[e._v("File path(s):  "),s("code",[e._v("node/modules/messager/*")])]),e._v(" "),s("h3",{attrs:{id:"listen-to-gateway-for-computeproof-requests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#listen-to-gateway-for-computeproof-requests"}},[e._v("#")]),e._v(" Listen to gateway for ComputeProof requests")]),e._v(" "),s("p",[e._v("This component is used to listen to the requests issued by the shared modules, and it is used to calculate the WinningPost in the miner.")]),e._v(" "),s("p",[e._v("File path(s): "),s("code",[e._v("cli/wallet_client.go")]),e._v(", "),s("code",[e._v("node/impl/proof_client/*")])]),e._v(" "),s("h3",{attrs:{id:"non-message-type-signing-to-local-wallet-storageask-dealproposal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#non-message-type-signing-to-local-wallet-storageask-dealproposal"}},[e._v("#")]),e._v(" Non-message type signing to local wallet（StorageAsk， DealProposal）")]),e._v(" "),s("p",[e._v("Since the private key no longer exists in the remote node, some message signing that do not require the participation of shared modules (such as StorageAsk, DealProposal) need to be connected to the wallet and sign locally")]),e._v(" "),s("p",[e._v("File path(s): "),s("code",[e._v("markets/storageadapter/provider.go")])]),e._v(" "),s("h3",{attrs:{id:"lotus-miner-disable-mining-blocks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lotus-miner-disable-mining-blocks"}},[e._v("#")]),e._v(" lotus-miner disable mining blocks")]),e._v(" "),s("p",[e._v("As shared modules are responsible for mining blocks, local block mining must be diabled to prevent  consensus errors. Therefore, you must disable local block mining.")]),e._v(" "),s("p",[e._v("File path(s): "),s("code",[e._v("node/modules/storageminer.go")]),e._v(" func "),s("code",[e._v("SetupBlockProducer")])])])}),[],!1,null,null,null);t.default=o.exports}}]);