(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{478:function(e,t,s){"use strict";s.r(t);var a=s(54),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"概要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[e._v("#")]),e._v(" 概要")]),e._v(" "),s("p",[e._v("通过对协议实验室的"),s("code",[e._v("lotus-miner")]),e._v("进行改造升级，能使其无缝接入"),s("code",[e._v("venus")]),e._v("共享组件。如您没有对"),s("code",[e._v("lotus-miner")]),e._v("添加过自定义代码，那么可以直接使用适配分支。如您对"),s("code",[e._v("lotus-miner")]),e._v("有定制化的代码，可以参考适配分支中最新的"),s("code",[e._v("commit")]),e._v("来添加适配代码。")]),e._v(" "),s("p",[e._v("主要变化功能点：")]),e._v(" "),s("ol",[s("li",[e._v("发送消息到共享组件")]),e._v(" "),s("li",[e._v("计算WinningPost证明")]),e._v(" "),s("li",[e._v("禁用本地出块")])]),e._v(" "),s("h3",{attrs:{id:"代码分支"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码分支"}},[e._v("#")]),e._v(" 代码分支")]),e._v(" "),s("p",[e._v("对应lotus版本的适配venus的lotus-miner分支如下表。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("lotus版本")]),e._v(" "),s("th",[e._v("适配venus分支")]),e._v(" "),s("th",[e._v("适配改造代码")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("1.10.1")]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commits/v1.10.1_incubation",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.10.1_incubation"),s("OutboundLink")],1)]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/4996c6e3f70b958bae8540d822c367c3aa3546ad",target:"_blank",rel:"noopener noreferrer"}},[e._v("4996c6e3f70b958bae8540d822c367c3aa3546ad"),s("OutboundLink")],1)])]),e._v(" "),s("tr",[s("td",[e._v("1.10.0")]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commits/v1.11.0_incubation",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.11.0_incubation"),s("OutboundLink")],1)]),e._v(" "),s("td",[s("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/a500491902058a4e6e59283cd56755d56701e4b1",target:"_blank",rel:"noopener noreferrer"}},[e._v("a500491902058a4e6e59283cd56755d56701e4b1"),s("OutboundLink")],1)])])])]),e._v(" "),s("h2",{attrs:{id:"代码行走"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码行走"}},[e._v("#")]),e._v(" 代码行走")]),e._v(" "),s("p",[e._v("以下大致概括了适配改造代码的一些要点。")]),e._v(" "),s("h3",{attrs:{id:"配置文件改变"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件改变"}},[e._v("#")]),e._v(" 配置文件改变")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[Venus]\n  [Venus.Messager]\n    Url = ""\n    Token = ""\n  [Venus.RegisterProofAPI]\n    Url = ""\n    Token = ""\n  [Venus.Wallet]\n    Url = ""\n    Token = ""\n')])])]),s("h3",{attrs:{id:"lotus-miner推送消息的api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lotus-miner推送消息的api"}},[e._v("#")]),e._v(" lotus-miner推送消息的API")]),e._v(" "),s("p",[e._v("lotus-miner提供的命令中需要发送，等待，搜索消息的命令全部通过调用lotus-miner新加的messager接口来实现。")]),e._v(" "),s("ol",[s("li",[e._v("MessagerWaitMessage")]),e._v(" "),s("li",[e._v("MessagerPushMessage")]),e._v(" "),s("li",[e._v("MessagerGetMessage")])]),e._v(" "),s("p",[e._v("位置：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("cmd/lotus-storage-miner/*\napi/api_storage.go\nextern/storage-sealing/sealing.go\nextern/storage-sealing/terminate_batch.go\nnode/modules/storageminer.go\nstorage/*\n")])])]),s("h3",{attrs:{id:"给messagesendspec添加gasoverestimate参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给messagesendspec添加gasoverestimate参数"}},[e._v("#")]),e._v(" 给MessageSendSpec添加GasOverEstimate参数")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("api/types.go")])]),e._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" MessageSendSpec "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tMaxFee            abi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("TokenAmount\n\tGasOverEstimation "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("float64")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h3",{attrs:{id:"miner检查发送消息的地址是否存在"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#miner检查发送消息的地址是否存在"}},[e._v("#")]),e._v(" miner检查发送消息的地址是否存在")]),e._v(" "),s("p",[e._v("lotus-miner中原先需要判断地址存在的接口，需要改成调用messager的WalletHas接口。")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("storage/addresses.go")])]),e._v(" "),s("h3",{attrs:{id:"venus-messager-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager-client"}},[e._v("#")]),e._v(" venus-messager client")]),e._v(" "),s("p",[e._v("venus-messager的客户端和lotus类似，都是使用的jsonrpc协议，可以同样使用lotus的jsonrpc库来接入。 需要注意的是命名空间是Message。")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("node/modules/messager/*")])]),e._v(" "),s("h3",{attrs:{id:"链接gateway以接受computeproof请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#链接gateway以接受computeproof请求"}},[e._v("#")]),e._v(" 链接gateway以接受ComputeProof请求")]),e._v(" "),s("p",[e._v("这个功能用于监听共享组件下发的请求，在miner中是为了用于计算WinningPost证明。")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("cli/wallet_client.go")]),e._v("， "),s("code",[e._v("node/impl/proof_client/*")])]),e._v(" "),s("h3",{attrs:{id:"非消息类型签名转到本钱包-storageask-proposaldeal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非消息类型签名转到本钱包-storageask-proposaldeal"}},[e._v("#")]),e._v(" 非消息类型签名转到本钱包（storageask， proposaldeal）")]),e._v(" "),s("p",[e._v("由于远程节点中不再存在私钥，一些不需要共享组件参与的签名（例如StorageAsk，DealProposal)需要连接钱包在本地进行签名。")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("markets/storageadapter/provider.go")])]),e._v(" "),s("h3",{attrs:{id:"lotus-miner禁用本地出块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lotus-miner禁用本地出块"}},[e._v("#")]),e._v(" lotus-miner禁用本地出块")]),e._v(" "),s("p",[e._v("因为共享组件已经在出块，本地如果在出块会导致共识错误，因此，务必禁用本地出块。")]),e._v(" "),s("p",[e._v("位置: "),s("code",[e._v("node/modules/storageminer.go")]),e._v(" 方法 "),s("code",[e._v("SetupBlockProducer")])])])}),[],!1,null,null,null);t.default=r.exports}}]);